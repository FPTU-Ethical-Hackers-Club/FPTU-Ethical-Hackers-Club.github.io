<!DOCTYPE html><html lang="vi" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="FPTU SecAthon 2021 Cryptographic Writeup CRY302 &amp; CRY303" /><meta name="author" content="fairytypean" /><meta property="og:locale" content="vi" /><meta name="description" content="CRY302" /><meta property="og:description" content="CRY302" /><link rel="canonical" href="https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY302-CRY303/" /><meta property="og:url" content="https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY302-CRY303/" /><meta property="og:site_name" content="Ethical Hackers Club" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-10T11:00:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="FPTU SecAthon 2021 Cryptographic Writeup CRY302 &amp; CRY303" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@fairytypean" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"dateModified":"2021-12-19T20:51:08+07:00","datePublished":"2021-10-10T11:00:00+07:00","description":"CRY302","mainEntityOfPage":{"@type":"WebPage","@id":"https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY302-CRY303/"},"url":"https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY302-CRY303/","@type":"BlogPosting","author":{"@type":"Person","name":"fairytypean"},"headline":"FPTU SecAthon 2021 Cryptographic Writeup CRY302 &amp; CRY303","@context":"https://schema.org"}</script><title>FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303 | Ethical Hackers Club</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ethical Hackers Club"><meta name="application-name" content="Ethical Hackers Club"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.updateMermaid(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ethical Hackers Club</a></div><div class="site-subtitle font-italic">FPT University</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a id="mode-toggle-wrapper" tabindex="0" onclick="flipMode()"> <i class="mode-toggle fas fa-adjust"></i> </a> <span class="icon-border"></span> <a href="https://github.com/FPTU-Ethical-Hackers-Club" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://facebook.com/ehc.fptu" aria-label="facebook" target="_blank" rel="noopener"> <i class="fab fa-facebook"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ehc.fpt','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/thangpd3160">fairytypean</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2021-10-10 11:00:00 +0700" data-toggle="tooltip" data-placement="bottom" title="Sun, Oct 10, 2021, 11:00 AM +0700" >Oct 10</em> </span> <span> Updated <em class="timeago" date="2021-12-19 20:51:08 +0700 " data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 19, 2021, 8:51 PM +0700" >Dec 19</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1268 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h1 id="cry302">CRY302</h1><p>Một bài liên quan tới hash, cách thực hiện khá dễ. Full source code bạn có thể xem tại <a href="https://github.com/thangpd3160/FUSEC-2021/blob/main/CRY302/server.py">đây</a></p><p><img data-proofer-ignore data-src="https://images.viblo.asia/82e681c0-6022-4524-80ac-2da6498a8ac9.png" alt="1" /></p><h2 id="bổ-đề">Bổ đề<a href="#bổ-đề"><i class="fas fa-hashtag"></i></a></h2></h2><p>Tóm tắt lại thì mình sẽ được đưa cho 1 số tiền ngẫu nhiên từ 1 tới 2000 và bị bắt phải mua 1 cái FLAG có giá tận 99,999. Kiểu gì cũng không đủ cho được.</p><p>Khi mình order 1 vật phẩm bất kỳ, <code class="language-plaintext highlighter-rouge">order</code> của mình sẽ có cấu trúc dạng kiểu <code class="language-plaintext highlighter-rouge">product=FLAG&amp;price=99999&amp;time=1633845957.70&amp;sign=67df43a8c83ea4ee53ac7bb61cc9a51661f5b55b54153afb942246c11a3ab9a93cb7a1cecb235195eab957fceb3e3daaf3e97f484d29718aea8b0f63e1a3704a</code> (đã được decode từ chuỗi base64 encoded).</p><p>Khi nhập lại cái <code class="language-plaintext highlighter-rouge">order</code> ở trên để xác nhận mua sản phẩm, <code class="language-plaintext highlighter-rouge">order</code> này được kiểm tra các cấu trúc và tính toàn vẹn, cụ thể gồm:</p><ul><li><p>Tồn tại cặp parameter-value <code class="language-plaintext highlighter-rouge">sign={sign_value}</code></p><li><p>Có signature hợp lệ <code class="language-plaintext highlighter-rouge">sha512(signkey+payment).hexdigest() == signature</code></p></ul><p>Sau khi qua các bài check trên, <code class="language-plaintext highlighter-rouge">payment</code> sẽ được truyền vào hàm <code class="language-plaintext highlighter-rouge">parse_sql(self, query)</code> để tiến hành extract các parameter tương ứng.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">parse_qsl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s">'&amp;'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">part</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s">'='</span><span class="p">)</span>
        <span class="n">m</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">m</span>
</pre></table></code></div></div><p>Với cách hàm parse hoạt động như này, giả sử query có 2 cặp giá trị của <code class="language-plaintext highlighter-rouge">price</code> (ví dụ như <code class="language-plaintext highlighter-rouge">price=99999&amp;price=0</code>) thì giá trị <code class="language-plaintext highlighter-rouge">price</code> cuối cùng sẽ được quyết định bởi cái đằng sau. Điều đó đồng nghĩa với việc nếu mình có thể kéo dài cái <code class="language-plaintext highlighter-rouge">payment</code> của mình bằng cách append thêm 1 đoạn <code class="language-plaintext highlighter-rouge">&amp;price=0</code>, mình có thể mua bất cứ thứ gì trong cửa hàng!</p><p>Ý tưởng kéo dài 1 đoạn payment được hash đã đưa mình đến <em>hash length extension attack</em></p><h2 id="hash-length-extension-attack">Hash length extension attack<a href="#hash-length-extension-attack"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="hash-length-extension-attack-là-gì">Hash length extension attack là gì?<a href="#hash-length-extension-attack-là-gì"><i class="fas fa-hashtag"></i></a></h3></h3><p>Hash length extension attack cho phép mình <em>kéo dài chuỗi văn bản được hash</em>, đồng thời tính toán <em>giá trị hash mới hợp lệ</em> cho chuỗi văn bản được kéo dài ra từ hash của chuỗi văn bản ban đầu.</p><h3 id="nguồn-đọc-hiểu-hash-length-extension-attack">Nguồn đọc hiểu hash length extension attack<a href="#nguồn-đọc-hiểu-hash-length-extension-attack"><i class="fas fa-hashtag"></i></a></h3></h3><p>Trước hết, cần phải hiểu được sha512 hoạt động như thế nào đã. Bạn có thể xem tổng quan về hàm sha512 tại <a href="http://https//medium.com/@zaid960928/cryptography-explaining-sha-512-ad896365a0c1">đây</a> và xem chi tiết cách sha512 vận hành từng bước 1 tại <a href="https://www.youtube.com/watch?v=JViXozmJnSk">đây</a>. Thanks for Indian guys ❤️</p><p>Tiếp đó, mình đọc mô tả cách hash length extension attack hoạt động, và có bản demo tại <a href="https://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks">đây</a>. Thực ra trước có 1 bài blog bằng tiếng Việt cho họ hash SHA luôn, mà giờ trang đấy sập rồi 😢 Nên mình sẽ mô tả lại trong bài này để các bạn hiểu dưới góc độ python code, phòng trường hợp các bạn đọc demo trên mạng đều code bằng C và không hiểu gì =)))</p><h3 id="điều-kiện-để-thực-hiện-hash-length-extension-attack">Điều kiện để thực hiện hash length extension attack<a href="#điều-kiện-để-thực-hiện-hash-length-extension-attack"><i class="fas fa-hashtag"></i></a></h3></h3><p>Để thực hiện được hash length extension attack mà văn bản xác thực có dạng <code class="language-plaintext highlighter-rouge">secret_value + public_value</code>, mình cần có đủ 3 dữ kiện:</p><ul><li><p>Độ dài của <code class="language-plaintext highlighter-rouge">secret_value</code>, ở trong bài này chính là độ dài của <code class="language-plaintext highlighter-rouge">signkey</code>. Bài không cho cụ thể nhưng chỉ cho 24 giá trị khả năng, hoàn toàn có thể bruteforce. Mình <em>không cần</em> giá trị của <code class="language-plaintext highlighter-rouge">secret_value</code>!</p><li><p>Giá trị của <code class="language-plaintext highlighter-rouge">public_value</code>, ở trong bài này chính là <code class="language-plaintext highlighter-rouge">payment</code></p><li><p>Giá trị hash của <code class="language-plaintext highlighter-rouge">secret_value + public_value</code>, ở trong bài này chính là <code class="language-plaintext highlighter-rouge">sign</code></p></ul><p>Vậy là bài này hội tụ đủ cả 3 yếu tố để tiến hành rồi.</p><h2 id="tiến-hành-tấn-công-thôi">Tiến hành tấn công thôi!<a href="#tiến-hành-tấn-công-thôi"><i class="fas fa-hashtag"></i></a></h2></h2><p>Mục tiêu của mình bao gồm:</p><ul><li><p>Append thêm 1 đoạn <code class="language-plaintext highlighter-rouge">&amp;price=0</code> vào cuối <code class="language-plaintext highlighter-rouge">payment</code></p><li><p>Tạo ra 1 giá trị <code class="language-plaintext highlighter-rouge">sign</code> mới sao cho <code class="language-plaintext highlighter-rouge">sha512(signkey+payment) = sign</code> với <code class="language-plaintext highlighter-rouge">payment</code> mới</p></ul><p>Sơ sơ cơ chế hoạt động của hash length extension attack sẽ như sau:</p><ul><li><p><strong>Cơ chế hoạt động của hàm hash:</strong> Hàm hash sha512 sẽ chia input đầu vào thành các khối 1024 bits, mỗi khối lại chia thành từng phần nhỏ <code class="language-plaintext highlighter-rouge">h[i]</code> gồm 128 bits. Một tuple <code class="language-plaintext highlighter-rouge">(h[0], h[1], h[2], h[3], h[4], h[5], h[6], h[7])</code> được gọi là <code class="language-plaintext highlighter-rouge">current_state</code> của hàm hash hiện tại. <code class="language-plaintext highlighter-rouge">current_state</code> sẽ được dùng để tính state cho khối 1024 bits tiếp theo. Hàm xử lý quá trình này gọi là <code class="language-plaintext highlighter-rouge">round_function</code> hoặc <code class="language-plaintext highlighter-rouge">compress</code> (tùy theo tài liệu). Kết quả cho khối 1024 bits cuối cùng chính là giá trị hash mình thu được.</p><li><p><strong>Cơ chế hoạt động của hash length extension attack:</strong> Từ cơ chế hoạt động trên của hàm hash, mình có thể thấy rằng chỉ cần biết được <code class="language-plaintext highlighter-rouge">current_state</code> và khối 1024 bits cuối cùng, mình hoàn toàn có thể tính toán <code class="language-plaintext highlighter-rouge">state</code> cho khối 1024 bits tiếp theo, trong đó, khối 1024 bits sẽ có giá trị tùy ý mình thích. Đó cũng chính là giá trị hash mới với chuỗi văn bản được kéo dài.</p></ul><p>Khá là đơn giản phải không. Giờ mình sẽ đi vào cụ thể nhé:</p><ol><li><p>Order FLAG, nhận giá trị <code class="language-plaintext highlighter-rouge">order</code> trả về <code class="language-plaintext highlighter-rouge">product=FLAG&amp;price=99999&amp;time=1633849486.36&amp;sign=275e626950c677c05a669e4e9d73f015858ca2b477335b2e99f419f9f0bc860736e95bd87de1226764c70f8c59029edc10e6b2a514342bb85f0c29fe24b9d3e2</code>. Tách <code class="language-plaintext highlighter-rouge">payment</code> và <code class="language-plaintext highlighter-rouge">sign</code> riêng.</p><li><p>Padding cho <code class="language-plaintext highlighter-rouge">payment</code> để <code class="language-plaintext highlighter-rouge">payment</code> có dạng <code class="language-plaintext highlighter-rouge">k ∗ 1024</code>, và lấy block cuối cùng, thu được <code class="language-plaintext highlighter-rouge">product=FLAG&amp;price=99999&amp;time=1633849486.36\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02P</code>. Vốn chuỗi ban đầu không dài hơn 1024 bits nên cũng chỉ có block duy nhất. Trong phần ví dụ này, mình giả sử độ dài của <code class="language-plaintext highlighter-rouge">signkey</code> bằng 31. Cơ chế padding mình đính kèm nguồn ở trên.</p><li><p>Append chuỗi <code class="language-plaintext highlighter-rouge">&amp;price=0</code> vào chuỗi đã được padding ở trên. Lại tạo 1 khối 1024 bits có chứa <code class="language-plaintext highlighter-rouge">&amp;price=0</code> bằng cách padding, thu được <code class="language-plaintext highlighter-rouge">&amp;price=0\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x018</code></p><li><p>Extract <code class="language-plaintext highlighter-rouge">state</code> từ giá trị <code class="language-plaintext highlighter-rouge">sign</code>, sau đó đưa <code class="language-plaintext highlighter-rouge">state</code> cùng khối 1024 bits có chứa <code class="language-plaintext highlighter-rouge">&amp;price=0</code> ở trên vào hàm <code class="language-plaintext highlighter-rouge">compress</code> của sha512, thu được giá trị mới bằng <code class="language-plaintext highlighter-rouge">ad38b9ceecbdf41de6bb33970a473ecc1c500935e2cfd90007be639fa6754b6272c45340fca0f173090748722cc1e25e3440cc9975c3b712a8cabe7809cf6d7f</code></p><li><p>Nối chuỗi <code class="language-plaintext highlighter-rouge">payment</code> mới và <code class="language-plaintext highlighter-rouge">sign</code> mới vào với nhau, chuyển lên server và lấy flag. order mới sẽ là <code class="language-plaintext highlighter-rouge">product=FLAG&amp;price=99999&amp;time=1633849486.36\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02P&amp;price=0</code></p></ol><p>Vậy là xong!</p><h2 id="full-code-exploit">Full code exploit<a href="#full-code-exploit"><i class="fas fa-hashtag"></i></a></h2></h2><p>Vì bài không cho giá trị cụ thể của độ dài <code class="language-plaintext highlighter-rouge">signkey</code>, nên mình phải viết 1 đoạn code chạy tự động trong khoảng giá trị <code class="language-plaintext highlighter-rouge">[8, 32]</code>. Full code exploit có thể xem ở <a href="http://https//github.com/thangpd3160/FUSEC-2021/blob/main/CRY302/solve.py">đây</a>. Trong code này, mình có sử dụng lại thư viện <a href="https://github.com/stephenbradshaw/hlextend/blob/master/hlextend.py">hlextend</a> của <em>stephenbradshaw</em> trên github, với một chút chỉnh sửa để output ra có dạng byte thay vì string.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">solve</span><span class="p">():</span>
    <span class="p">[</span><span class="n">REDACTED</span><span class="p">]</span>

    <span class="c1">#order
</span>    <span class="n">output</span> <span class="o">=</span> <span class="n">recvuntil</span><span class="p">(</span><span class="n">clientSock</span><span class="p">,</span> <span class="sa">b</span><span class="s">'Your choice:'</span><span class="p">)</span>
    <span class="n">clientSock</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s">'2</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">recvuntil</span><span class="p">(</span><span class="n">clientSock</span><span class="p">,</span> <span class="sa">b</span><span class="s">'ID:'</span><span class="p">)</span>
    <span class="n">clientSock</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s">'6</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">recvuntil</span><span class="p">(</span><span class="n">clientSock</span><span class="p">,</span> <span class="sa">b</span><span class="s">'Your choice:'</span><span class="p">)</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">output</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="s">'Your order:'</span><span class="p">):].</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">order</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'latin-1'</span><span class="p">)</span>

    <span class="n">sp</span> <span class="o">=</span> <span class="n">order</span><span class="p">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">'&amp;sign='</span><span class="p">)</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="n">sp</span><span class="o">+</span><span class="mi">6</span><span class="p">:]</span>
    <span class="n">payment</span> <span class="o">=</span> <span class="n">order</span><span class="p">[:</span><span class="n">sp</span><span class="p">]</span>
    <span class="n">append_msg</span> <span class="o">=</span> <span class="s">'&amp;price=0'</span>
    

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">33</span><span class="p">):</span>
        <span class="n">sha</span> <span class="o">=</span> <span class="n">hlextend</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s">'sha512'</span><span class="p">)</span>
        <span class="n">new_payment</span> <span class="o">=</span> <span class="n">sha</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">append_msg</span><span class="p">,</span> <span class="n">payment</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span>
        <span class="n">new_sign</span> <span class="o">=</span> <span class="n">sha</span><span class="p">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">new_order</span> <span class="o">=</span> <span class="n">new_payment</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'&amp;sign='</span> <span class="o">+</span> <span class="n">new_sign</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">new_order</span> <span class="o">=</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">new_order</span><span class="p">)</span>

        <span class="c1">#confirm order
</span>        <span class="n">clientSock</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s">'3</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">recvuntil</span><span class="p">(</span><span class="n">clientSock</span><span class="p">,</span> <span class="sa">b</span><span class="s">'Your order:'</span><span class="p">)</span>
        <span class="n">clientSock</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">new_order</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">recvuntil</span><span class="p">(</span><span class="n">clientSock</span><span class="p">,</span> <span class="sa">b</span><span class="s">'Your choice:'</span><span class="p">)</span>
        <span class="k">if</span> <span class="sa">b</span><span class="s">'FUSec{'</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">output</span><span class="p">.</span><span class="n">decode</span><span class="p">()[</span><span class="n">output</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="sa">b</span><span class="s">'FUSec{'</span><span class="p">):</span><span class="n">output</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="sa">b</span><span class="s">'}'</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
            <span class="k">break</span>
</pre></table></code></div></div><p>Flag <code class="language-plaintext highlighter-rouge">FUSec{th1s_1s_4n_0ld_vul_bUt...}</code></p><h1 id="cry303">CRY303</h1><p>Một bài siêu khó về <strong>Knapsack cipher</strong> sử dụng LLL (Lenstra–Lenstra–Lovász), hay còn gọi là <strong>Latice Reducation Technique</strong>, để giải.</p><p>Nói thật thì bài này mình cũng không tự làm được lúc tham gia giải CTF, nhưng search google được 1 bài giống tới 90%, nên chỉ đọc hiểu code rồi giải lại. Bởi vì bài cũng không có gì khác biệt mấy, nên mình để nguồn bài gốc ở đây để các bạn đọc vậy.</p><ul><li><p><a href="https://github.com/pcw109550/write-up/tree/master/2020/KAPO/Baby_Bubmi">Link github exploit code + writeup</a></p><li><p><a href="http://www.secmem.org/blog/2020/09/20/poka-science-war-hacking/">Bài viết cụ thể giải thích cơ chế hoạt động</a></p></ul><p>Đề bài này và code giải (đã sửa theo bài) mình để ở <a href="https://github.com/thangpd3160/FUSEC-2021/tree/main/CRY303">github</a> của mình.</p><blockquote><p>Thế là hết crypto rồi. Nếu mà kịp giải hết thì mình cũng mạnh dạn insert bomman meme gáy… nhưng không được nên gà không gáy nữa…</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/cryptographic-challenges/'>Cryptographic Challenges</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeups/" class="post-tag no-text-decoration" >writeups</a> <a href="/tags/cryptographic/" class="post-tag no-text-decoration" >cryptographic</a> <a href="/tags/fusec21/" class="post-tag no-text-decoration" >fusec21</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303 - Ethical Hackers Club&url=https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY302-CRY303/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303 - Ethical Hackers Club&u=https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY302-CRY303/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303 - Ethical Hackers Club&url=https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY302-CRY303/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h4>Recent Update</h4><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/SVATTT-Crypto/">ASCIS (ASEAN Student Contest on Information Security) 's Cryptography Write-ups</a><li><a href="/posts/SVATTT-Web/">ASCIS (ASEAN Student Contest on Information Security) 's Web Write-ups</a><li><a href="/posts/FuSec3-Forensics/">FPTU SecAthon 2020 | Forensics Writeup | FRS301</a><li><a href="/posts/ACSC2021-Forensics/">Asian Cyber Security Challenge 2021 | Forensics Writeup | Nyong Coin, BitLocker Artifact</a><li><a href="/posts/FuSec4-CRY302-CRY303/">FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303</a></ul></div><div id="access-tags"><h4 class="text-muted">Trending Tags</h4><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/wiki/">wiki</a> <a class="post-tag" href="/tags/fusec21/">fusec21</a> <a class="post-tag" href="/tags/cryptographic/">cryptographic</a> <a class="post-tag" href="/tags/fusec20/">fusec20</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/acsc21/">acsc21</a> <a class="post-tag" href="/tags/svattt2021/">SVATTT2021</a> <a class="post-tag" href="/tags/binary/">binary</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h4 class="pl-3 pt-2 mb-2">Contents</h4><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/FuSec4-CRY301/"><div class="card-body"> <em class="timeago small" date="2021-10-10 10:00:00 +0700" >Oct 10</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>FPTU SecAthon 2021 | Cryptographic Writeup | CRY301</h3><div class="text-muted small"><p> CRY301 Source code and analysis Một bài crypto giải bằng kiến thức toán học và tư duy về code. Full source code đề bài xem tại đây Bài này yêu cầu mình tìm được số x ban đầu từ kết quả của 2 hàm...</p></div></div></a></div><div class="card"> <a href="/posts/SVATTT-Crypto/"><div class="card-body"> <em class="timeago small" date="2021-10-16 22:00:00 +0700" >Oct 16</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ASCIS (ASEAN Student Contest on Information Security) 's Cryptography Write-ups</h3><div class="text-muted small"><p> EasyOne A challenge about digital certificate problem, just the basic things. Full source code can found at here. 1. Challenge analysis Read the source code, I figured out that there is a ...</p></div></div></a></div><div class="card"> <a href="/posts/FuSec3-CRY301-CRY302/"><div class="card-body"> <em class="timeago small" date="2020-10-21 15:34:00 +0700" >Oct 21, 2020</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>FPTU SecAthon 2020 | Cryptographic Writeup | CRY301 & CRY302</h3><div class="text-muted small"><p> This is an annual competition for FPT University students to practice their skills with jeopardy CTF challenges. I was with my team, M1sh13f, and we’re at the #5 place. Congrats me and my amaz...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/FuSec4-CRY301/" class="btn btn-outline-primary" prompt="Older"><p>FPTU SecAthon 2021 | Cryptographic Writeup | CRY301</p></a> <a href="/posts/FuSec4-PRP201/" class="btn btn-outline-primary" prompt="Newer"><p>FPTU SecAthon 2021 | Web Writeup | PRP201</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/FPTU-Ethical-Hackers-Club">FPTU Ethical Hackers' Club</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><h4 class="text-muted">Trending Tags</h4><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/wiki/">wiki</a> <a class="post-tag" href="/tags/fusec21/">fusec21</a> <a class="post-tag" href="/tags/cryptographic/">cryptographic</a> <a class="post-tag" href="/tags/fusec20/">fusec20</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/acsc21/">acsc21</a> <a class="post-tag" href="/tags/svattt2021/">SVATTT2021</a> <a class="post-tag" href="/tags/binary/">binary</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
