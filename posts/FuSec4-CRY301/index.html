<!DOCTYPE html><html lang="vi" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="FPTU SecAthon 2021 Cryptographic Writeup CRY301" /><meta name="author" content="fairytypean" /><meta property="og:locale" content="vi" /><meta name="description" content="CRY301" /><meta property="og:description" content="CRY301" /><link rel="canonical" href="https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY301/" /><meta property="og:url" content="https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY301/" /><meta property="og:site_name" content="Ethical Hackers Club" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-10T10:00:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="FPTU SecAthon 2021 Cryptographic Writeup CRY301" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@fairytypean" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"dateModified":"2021-10-10T10:00:00+07:00","datePublished":"2021-10-10T10:00:00+07:00","description":"CRY301","mainEntityOfPage":{"@type":"WebPage","@id":"https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY301/"},"url":"https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY301/","@type":"BlogPosting","author":{"@type":"Person","name":"fairytypean"},"headline":"FPTU SecAthon 2021 Cryptographic Writeup CRY301","@context":"https://schema.org"}</script><title>FPTU SecAthon 2021 | Cryptographic Writeup | CRY301 | Ethical Hackers Club</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ethical Hackers Club"><meta name="application-name" content="Ethical Hackers Club"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.updateMermaid(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ethical Hackers Club</a></div><div class="site-subtitle font-italic">FPT University</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a id="mode-toggle-wrapper" tabindex="0" onclick="flipMode()"> <i class="mode-toggle fas fa-adjust"></i> </a> <span class="icon-border"></span> <a href="https://github.com/FPTU-Ethical-Hackers-Club" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://facebook.com/ehc.fptu" aria-label="facebook" target="_blank" rel="noopener"> <i class="fab fa-facebook"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ehc.fpt','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>FPTU SecAthon 2021 | Cryptographic Writeup | CRY301</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>FPTU SecAthon 2021 | Cryptographic Writeup | CRY301</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/thangpd3160">fairytypean</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2021-10-10 10:00:00 +0700" data-toggle="tooltip" data-placement="bottom" title="Sun, Oct 10, 2021, 10:00 AM +0700" >Oct 10</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1192 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><h1 id="cry301">CRY301</h1><h2 id="source-code-and-analysis">Source code and analysis<a href="#source-code-and-analysis"><i class="fas fa-hashtag"></i></a></h2></h2><p>Một bài crypto giải bằng kiến thức toán học và tư duy về code. Full source code đề bài xem tại <a href="https://github.com/thangpd3160/FUSEC-2021/blob/main/CRY301/server.py">đây</a></p><p>Bài này yêu cầu mình tìm được số <code class="language-plaintext highlighter-rouge">x</code> ban đầu từ kết quả của 2 hàm <code class="language-plaintext highlighter-rouge">easyone(x)</code> và <code class="language-plaintext highlighter-rouge">alittlebitharderone(x)</code>.</p><h2 id="phân-tích-hàm-easyonex">Phân tích hàm <code class="language-plaintext highlighter-rouge">easyone(x)</code><a href="#phân-tích-hàm-easyonex"><i class="fas fa-hashtag"></i></a></h2></h2><p>Nhìn sơ qua hàm <code class="language-plaintext highlighter-rouge">easyone(x)</code>, có 3 phép biến đổi chính được lặp đi lặp lại 3 lần:</p><ul><li><p>Phép <code class="language-plaintext highlighter-rouge">xor</code> với left shift bit của chính nó</p><li><p>Phép nhân</p><li><p>Phép <code class="language-plaintext highlighter-rouge">&amp;</code> với <code class="language-plaintext highlighter-rouge">0xffffffffffffffffffffffffffffffff</code>.</p></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">easyone</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">128</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">^=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="mi">19</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="mh">0xd3856e824d9c8a26aef65c0fe1cc96db</span> <span class="c1">#281159923981539500379670095774511568603
</span>    <span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
    <span class="n">x</span> <span class="o">^=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="mh">0xe44035c8f8387dc11dd3dd67097007cb</span> <span class="c1">#303397380928069120521467215513016862667
</span>    <span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
    <span class="n">x</span> <span class="o">^=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="mh">0xc9f54782b4f17cb68ecf11d7b378e445</span> <span class="c1">#268448390289851351177030176676964262981
</span>    <span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
    <span class="n">x</span> <span class="o">^=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></table></code></div></div><p>Như vậy, có 2 bài toán đặt ra cần giải quyết:</p><ul><li><p>Tìm <code class="language-plaintext highlighter-rouge">x</code> biết <code class="language-plaintext highlighter-rouge">a * x = b (mod n)</code> với <code class="language-plaintext highlighter-rouge">a</code>, <code class="language-plaintext highlighter-rouge">b</code>, <code class="language-plaintext highlighter-rouge">n</code> đã cho trước</p><li><p>Khôi phục lại kết quả phép xor. Tìm <code class="language-plaintext highlighter-rouge">x</code> có $a \oplus x = b$ với <code class="language-plaintext highlighter-rouge">a</code>, <code class="language-plaintext highlighter-rouge">b</code> đã biết, khá đơn giản với $x = a \oplus b$.</p></ul><p>Cùng đi sâu hơn chút vào từng bài toán 1 nhé</p><h3 id="bài-toán-đầu-tiên">Bài toán đầu tiên<a href="#bài-toán-đầu-tiên"><i class="fas fa-hashtag"></i></a></h3></h3><p>Đây là bài toán cơ bản cơ bản về inverse mod (modular inverse) trong finite field (trường hữu hạn). Đơn giản, mình có thể tìm $x$ bằng cách $x = a^{-1} * b$ $(mod$ $n)$, trong đó, $a^{-1} * b$ $(mod$ $n)$ là giá trị inverse modulo của a trong finite field $(mod$ $n)$</p><p>Chi tiết cách tìm inverse mod bằng toán học với extended euclidean algorithm có thể xem tại <a href="https://www.youtube.com/watch?v=fq6SXByItUI">đây</a>. Lúc code giải thì mình dùng luôn hàm <code class="language-plaintext highlighter-rouge">invert(a, n)</code> trong thư viện <code class="language-plaintext highlighter-rouge">gmpy2</code> của python để tìm $a^{-1} * b$ $(mod$ $n)$.</p><p>Mình chuyển 1 đoạn code sang dạng bài toán gốc để dễ hình dung. Cụ thể, đoạn code dưới đây biểu diễn dưới dạng toán học sẽ là $x * 281159923981539500379670095774511568603 = b$ $(mod$ $n)$ với <code class="language-plaintext highlighter-rouge">b</code> có thể thu được từ việc dịch lại phép <code class="language-plaintext highlighter-rouge">xor</code> (bài toán 2).</p><blockquote><p>Lưu ý: <code class="language-plaintext highlighter-rouge">x &amp;= 0xffffffffffffffffffffffffffffffff &lt;=&gt; x %= 0xffffffffffffffffffffffffffffffff</code> hay <code class="language-plaintext highlighter-rouge">x %= 2**128</code></p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">x</span> <span class="o">*=</span> <span class="mh">0xd3856e824d9c8a26aef65c0fe1cc96db</span> <span class="c1">#281159923981539500379670095774511568603
</span><span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
</pre></table></code></div></div><p>Như vậy, ta có thể dễ dàng tìm <code class="language-plaintext highlighter-rouge">x</code> với $x = b$ $∗$ $281159923981539500379670095774511568603^{−1}$ $(mod$ $2^{128})$</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">x</span> <span class="o">*=</span> <span class="n">gmpy2</span><span class="p">.</span><span class="n">invert</span><span class="p">(</span><span class="mi">268448390289851351177030176676964262981</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">128</span><span class="p">)</span>
<span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
</pre></table></code></div></div><p>Vấn đề là để hoàn thiện quá trình giải thì mình cần tìm <code class="language-plaintext highlighter-rouge">b</code>, nghĩa là cần phải giải quyết bài toán số 2.</p><h3 id="bài-toán-thứ-2">Bài toán thứ 2<a href="#bài-toán-thứ-2"><i class="fas fa-hashtag"></i></a></h3></h3><p>Để giải quyết phần <code class="language-plaintext highlighter-rouge">xor</code> này, chúng ta cần phải lưu tâm <code class="language-plaintext highlighter-rouge">x</code> sau khi bitshift thì còn những bit nào còn giữ nguyên, bit nào dịch chuyển để thực hiện <code class="language-plaintext highlighter-rouge">xor</code>.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">x</span> <span class="o">^=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
</pre></table></code></div></div><p>Để dễ hình dung, bạn có thể nhìn hình mô phỏng trước và sau khi leftshift dưới đây. Bit màu xanh là những bit còn giữ nguyên sau khi leftshift. Bit màu vàng là bit màu xanh được chuyển ra sau khi leftshift. Bit màu đỏ là những bit có thể bị thay đổi sau bitshift (và cũng là bit thực sự tham gia <code class="language-plaintext highlighter-rouge">xor</code>)</p><p><img data-proofer-ignore data-src="https://images.viblo.asia/6ade6ce4-5714-4116-8dcf-a0033e31384d.png" alt="1" /></p><p>Dễ dàng nhận thấy, phần bit dùng để xor với giá trị x ban đầu vẫn <em>giữ nguyên</em> sau khi <code class="language-plaintext highlighter-rouge">xor</code> $\longrightarrow$. Như vậy mình có thể dễ dàng khôi phục phần bit dùng để <code class="language-plaintext highlighter-rouge">xor</code> bằng cách <em>leftshift lại giá trị sau khi xor bằng đúng một khoảng dùng để xor trước đó</em> (tức <code class="language-plaintext highlighter-rouge">leftshift (64 + 2)</code> đơn vị trong trường hợp trên).</p><p>Kết luận trên đúng với tất cả trường mà <code class="language-plaintext highlighter-rouge">x</code> được leftshift ít nhất 64 đơn vị.</p><p>Vậy là mình đã giải quyết xong cả 2 bài toán trên! Cuối cùng mình có đoạn code để lấy giá trị <code class="language-plaintext highlighter-rouge">x</code> từ hàm <code class="language-plaintext highlighter-rouge">easyone(x)</code> như sau:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">solveeasyone</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">^=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="n">gmpy2</span><span class="p">.</span><span class="n">invert</span><span class="p">(</span><span class="mi">268448390289851351177030176676964262981</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
    <span class="n">x</span> <span class="o">^=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="n">gmpy2</span><span class="p">.</span><span class="n">invert</span><span class="p">(</span><span class="mi">303397380928069120521467215513016862667</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
    <span class="n">x</span> <span class="o">^=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="n">gmpy2</span><span class="p">.</span><span class="n">invert</span><span class="p">(</span><span class="mi">281159923981539500379670095774511568603</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
    <span class="n">x</span> <span class="o">^=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="mi">19</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></table></code></div></div><p>Tada, first round~~</p><p><img data-proofer-ignore data-src="https://images.viblo.asia/2db1bbfe-b210-4a94-9758-dac7962e879c.png" alt="2" /></p><h2 id="phân-tích-hàm-alittlebitharderonex">Phân tích hàm <code class="language-plaintext highlighter-rouge">alittlebitharderone(x)</code><a href="#phân-tích-hàm-alittlebitharderonex"><i class="fas fa-hashtag"></i></a></h2></h2><p>Giải quyết hàm này cũng cần giải quyết 2 bài toán như hàm <code class="language-plaintext highlighter-rouge">easyone(x)</code>. Bài toán 1 về tìm inverse mod hoàn toàn giống hệt. Cái khó hơn nằm ở Bài toán 2, do mình không thể ngay lập tức khôi phụ được bit dùng trong phép <code class="language-plaintext highlighter-rouge">xor</code> trước đó từ kết quả thu được.</p><p>Tuy nhiên, điều đáng mừng là nguyên lý cách làm vẫn thế. Chúng ta cũng sẽ dùng những bit còn nguyên, để khôi phục lại những bit gốc, rồi lân la dần dần để khôi phục toàn bộ bit gốc đó. Mình mô phỏng với 1 bài toán nhỏ với 1 chuỗi 6 bit với độ leftshift bằng 2 như sau:</p><p><img data-proofer-ignore data-src="https://images.viblo.asia/15156dc0-6a32-4833-9b3f-8de565499e2a.png" alt="3" /></p><p>Với trường hợp như trên, mình khôi phục lại giá trị ban đầu của <code class="language-plaintext highlighter-rouge">x</code> bằng cách đi qua từng bước như sau đây (Mô tả bằng hình ảnh cho dễ hiểu nhé)</p><ul><li><p><code class="language-plaintext highlighter-rouge">Xor</code> 2 bit đầu (2 bit còn giữ nguyên sau khi <code class="language-plaintext highlighter-rouge">xor</code>) với 2 bit liền kều sau nó. Những bit còn lại giữ nguyên. Như vậy, mình đã khôi phục lại được bit số 3 và bit số 2:</p><p><img data-proofer-ignore data-src="https://images.viblo.asia/c4e889d6-91fc-4bdd-ba28-bd35b628b7e3.png" alt="4" /></p><li><p><code class="language-plaintext highlighter-rouge">Xor</code> tiếp 2 bit vừa thu được (bit số 3 và 2) với 2 bit liền kề sau nó để khôi phục tiếp 2 bit còn lại (bit 5 và 6) : <img data-proofer-ignore data-src="https://images.viblo.asia/42916e48-cf34-4a14-bc3b-c70869387a78.png" alt="5" /></p></ul><p>Vậy làm mình đã thu lại được đoạn bit gốc, tức giá trị của <code class="language-plaintext highlighter-rouge">x</code> cần tìm. Với chuỗi bit dài hơn, mình chỉ cần chạy quá trình trên lặp đi lặp lại là được.</p><p>Dễ rồi phải không? Mặc dù mình nghĩ ra được ý tưởng mình việc code tốn của mình tận 30 phút… và cuối cùng lại chỉ thành 1 đoạn code ngắn ngủi sau:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="n">_b</span><span class="p">))</span> <span class="k">for</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">shiftsolong</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bitshift</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">'{0:b}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">bitshift</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">bitshift</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="n">xor</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">bitshift</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">bitshift</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">x</span><span class="p">[</span><span class="n">bitshift</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">bitshift</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)])</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">bitshift</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">):]</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></table></code></div></div><p>Ta nói đời về căn bản là buồn mà 😢 Thôi tổng hợp lại, thì mình có đoạn code lấy lại giá trị <code class="language-plaintext highlighter-rouge">x</code> từ hàm <code class="language-plaintext highlighter-rouge">alittlebitharderone(x)</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">solvehardone</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">shiftsolong</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="n">gmpy2</span><span class="p">.</span><span class="n">invert</span><span class="p">(</span><span class="mi">268448390289851351177030176676964262981</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">shiftsolong</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="n">gmpy2</span><span class="p">.</span><span class="n">invert</span><span class="p">(</span><span class="mi">303397380928069120521467215513016862667</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">shiftsolong</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="n">gmpy2</span><span class="p">.</span><span class="n">invert</span><span class="p">(</span><span class="mi">281159923981539500379670095774511568603</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">&amp;=</span> <span class="mh">0xffffffffffffffffffffffffffffffff</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">shiftsolong</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></table></code></div></div><p>Qua vòng 2 và nhận được flag. Chỉ là không kịp submit nữa…</p><p><img data-proofer-ignore data-src="https://images.viblo.asia/dcae7e07-d742-4c9c-a62d-19b14cb0e491.png" alt="6" /></p><p>Nếu có ước muốn trong cuộc đời này, mình sẽ ước có một không gian riêng mà thời gian chảy chậm để ngồi debug trước khi hết giờ FUSEC 😇</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/cryptographic-challenges/'>Cryptographic Challenges</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeups/" class="post-tag no-text-decoration" >writeups</a> <a href="/tags/cryptographic/" class="post-tag no-text-decoration" >cryptographic</a> <a href="/tags/fusec21/" class="post-tag no-text-decoration" >fusec21</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=FPTU SecAthon 2021 | Cryptographic Writeup | CRY301 - Ethical Hackers Club&url=https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY301/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=FPTU SecAthon 2021 | Cryptographic Writeup | CRY301 - Ethical Hackers Club&u=https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY301/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=FPTU SecAthon 2021 | Cryptographic Writeup | CRY301 - Ethical Hackers Club&url=https://fptu-ethical-hackers-club.github.io/posts/FuSec4-CRY301/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h4>Recent Update</h4><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/SVATTT-Crypto/">ASCIS (ASEAN Student Contest on Information Security) 's Cryptography Write-ups</a><li><a href="/posts/SVATTT-Web/">ASCIS (ASEAN Student Contest on Information Security) 's Web Write-ups</a><li><a href="/posts/FuSec3-Forensics/">FPTU SecAthon 2020 | Forensics Writeup | FRS301</a><li><a href="/posts/ACSC2021-Forensics/">Asian Cyber Security Challenge 2021 | Forensics Writeup | Nyong Coin, BitLocker Artifact</a><li><a href="/posts/FuSec4-CRY302-CRY303/">FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303</a></ul></div><div id="access-tags"><h4 class="text-muted">Trending Tags</h4><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/wiki/">wiki</a> <a class="post-tag" href="/tags/fusec21/">fusec21</a> <a class="post-tag" href="/tags/cryptographic/">cryptographic</a> <a class="post-tag" href="/tags/fusec20/">fusec20</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/acsc21/">acsc21</a> <a class="post-tag" href="/tags/svattt2021/">SVATTT2021</a> <a class="post-tag" href="/tags/binary/">binary</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h4 class="pl-3 pt-2 mb-2">Contents</h4><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/FuSec4-CRY302-CRY303/"><div class="card-body"> <em class="timeago small" date="2021-10-10 11:00:00 +0700" >Oct 10</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303</h3><div class="text-muted small"><p> CRY302 Một bài liên quan tới hash, cách thực hiện khá dễ. Full source code bạn có thể xem tại đây Bổ đề Tóm tắt lại thì mình sẽ được đưa cho 1 số tiền ngẫu nhiên từ 1 tới 2000 và bị bắt phải m...</p></div></div></a></div><div class="card"> <a href="/posts/SVATTT-Crypto/"><div class="card-body"> <em class="timeago small" date="2021-10-16 22:00:00 +0700" >Oct 16</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ASCIS (ASEAN Student Contest on Information Security) 's Cryptography Write-ups</h3><div class="text-muted small"><p> EasyOne A challenge about digital certificate problem, just the basic things. Full source code can found at here. 1. Challenge analysis Read the source code, I figured out that there is a ...</p></div></div></a></div><div class="card"> <a href="/posts/FuSec3-CRY301-CRY302/"><div class="card-body"> <em class="timeago small" date="2020-10-21 15:34:00 +0700" >Oct 21, 2020</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>FPTU SecAthon 2020 | Cryptographic Writeup | CRY301 & CRY302</h3><div class="text-muted small"><p> This is an annual competition for FPT University students to practice their skills with jeopardy CTF challenges. I was with my team, M1sh13f, and we’re at the #5 place. Congrats me and my amaz...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/FuSec4-IAW302/" class="btn btn-outline-primary" prompt="Older"><p>FPTU SecAthon 2021 | Web Writeup | IAW302</p></a> <a href="/posts/FuSec4-CRY302-CRY303/" class="btn btn-outline-primary" prompt="Newer"><p>FPTU SecAthon 2021 | Cryptographic Writeup | CRY302 & CRY303</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/FPTU-Ethical-Hackers-Club">FPTU Ethical Hackers' Club</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><h4 class="text-muted">Trending Tags</h4><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/wiki/">wiki</a> <a class="post-tag" href="/tags/fusec21/">fusec21</a> <a class="post-tag" href="/tags/cryptographic/">cryptographic</a> <a class="post-tag" href="/tags/fusec20/">fusec20</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/acsc21/">acsc21</a> <a class="post-tag" href="/tags/svattt2021/">SVATTT2021</a> <a class="post-tag" href="/tags/binary/">binary</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
